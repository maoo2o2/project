var Hn=Object.defineProperty;var Zt=t=>{throw TypeError(t)};var zn=(t,e,n)=>e in t?Hn(t,e,{enumerable:!0,configurable:!0,writable:!0,value:n}):t[e]=n;var P=(t,e,n)=>zn(t,typeof e!="symbol"?e+"":e,n),Jt=(t,e,n)=>e.has(t)||Zt("Cannot "+n);var v=(t,e,n)=>(Jt(t,e,"read from private field"),n?n.call(t):e.get(t)),le=(t,e,n)=>e.has(t)?Zt("Cannot add the same private member more than once"):e instanceof WeakSet?e.add(t):e.set(t,n),$e=(t,e,n,o)=>(Jt(t,e,"write to private field"),o?o.call(t,n):e.set(t,n),n);(function(){const e=document.createElement("link").relList;if(e&&e.supports&&e.supports("modulepreload"))return;for(const r of document.querySelectorAll('link[rel="modulepreload"]'))o(r);new MutationObserver(r=>{for(const i of r)if(i.type==="childList")for(const a of i.addedNodes)a.tagName==="LINK"&&a.rel==="modulepreload"&&o(a)}).observe(document,{childList:!0,subtree:!0});function n(r){const i={};return r.integrity&&(i.integrity=r.integrity),r.referrerPolicy&&(i.referrerPolicy=r.referrerPolicy),r.crossOrigin==="use-credentials"?i.credentials="include":r.crossOrigin==="anonymous"?i.credentials="omit":i.credentials="same-origin",i}function o(r){if(r.ep)return;r.ep=!0;const i=n(r);fetch(r.href,i)}})();var _;(function(t){t.LOAD="LOAD",t.EXEC="EXEC",t.FFPROBE="FFPROBE",t.WRITE_FILE="WRITE_FILE",t.READ_FILE="READ_FILE",t.DELETE_FILE="DELETE_FILE",t.RENAME="RENAME",t.CREATE_DIR="CREATE_DIR",t.LIST_DIR="LIST_DIR",t.DELETE_DIR="DELETE_DIR",t.ERROR="ERROR",t.DOWNLOAD="DOWNLOAD",t.PROGRESS="PROGRESS",t.LOG="LOG",t.MOUNT="MOUNT",t.UNMOUNT="UNMOUNT"})(_||(_={}));const Gn=(()=>{let t=0;return()=>t++})(),qn=new Error("ffmpeg is not loaded, call `await ffmpeg.load()` first"),Vn=new Error("called FFmpeg.terminate()");var X,fe,te,we,De,wt,B;class Kn{constructor(){le(this,X,null);le(this,fe,{});le(this,te,{});le(this,we,[]);le(this,De,[]);P(this,"loaded",!1);le(this,wt,()=>{v(this,X)&&(v(this,X).onmessage=({data:{id:e,type:n,data:o}})=>{switch(n){case _.LOAD:this.loaded=!0,v(this,fe)[e](o);break;case _.MOUNT:case _.UNMOUNT:case _.EXEC:case _.FFPROBE:case _.WRITE_FILE:case _.READ_FILE:case _.DELETE_FILE:case _.RENAME:case _.CREATE_DIR:case _.LIST_DIR:case _.DELETE_DIR:v(this,fe)[e](o);break;case _.LOG:v(this,we).forEach(r=>r(o));break;case _.PROGRESS:v(this,De).forEach(r=>r(o));break;case _.ERROR:v(this,te)[e](o);break}delete v(this,fe)[e],delete v(this,te)[e]})});le(this,B,({type:e,data:n},o=[],r)=>v(this,X)?new Promise((i,a)=>{const s=Gn();v(this,X)&&v(this,X).postMessage({id:s,type:e,data:n},o),v(this,fe)[s]=i,v(this,te)[s]=a,r==null||r.addEventListener("abort",()=>{a(new DOMException(`Message # ${s} was aborted`,"AbortError"))},{once:!0})}):Promise.reject(qn));P(this,"load",({classWorkerURL:e,...n}={},{signal:o}={})=>(v(this,X)||($e(this,X,e?new Worker(new URL(e,import.meta.url),{type:"module"}):new Worker(new URL("/project/3clip/assets/worker-BAOIWoxA.js",import.meta.url),{type:"module"})),v(this,wt).call(this)),v(this,B).call(this,{type:_.LOAD,data:n},void 0,o)));P(this,"exec",(e,n=-1,{signal:o}={})=>v(this,B).call(this,{type:_.EXEC,data:{args:e,timeout:n}},void 0,o));P(this,"ffprobe",(e,n=-1,{signal:o}={})=>v(this,B).call(this,{type:_.FFPROBE,data:{args:e,timeout:n}},void 0,o));P(this,"terminate",()=>{const e=Object.keys(v(this,te));for(const n of e)v(this,te)[n](Vn),delete v(this,te)[n],delete v(this,fe)[n];v(this,X)&&(v(this,X).terminate(),$e(this,X,null),this.loaded=!1)});P(this,"writeFile",(e,n,{signal:o}={})=>{const r=[];return n instanceof Uint8Array&&r.push(n.buffer),v(this,B).call(this,{type:_.WRITE_FILE,data:{path:e,data:n}},r,o)});P(this,"mount",(e,n,o)=>{const r=[];return v(this,B).call(this,{type:_.MOUNT,data:{fsType:e,options:n,mountPoint:o}},r)});P(this,"unmount",e=>{const n=[];return v(this,B).call(this,{type:_.UNMOUNT,data:{mountPoint:e}},n)});P(this,"readFile",(e,n="binary",{signal:o}={})=>v(this,B).call(this,{type:_.READ_FILE,data:{path:e,encoding:n}},void 0,o));P(this,"deleteFile",(e,{signal:n}={})=>v(this,B).call(this,{type:_.DELETE_FILE,data:{path:e}},void 0,n));P(this,"rename",(e,n,{signal:o}={})=>v(this,B).call(this,{type:_.RENAME,data:{oldPath:e,newPath:n}},void 0,o));P(this,"createDir",(e,{signal:n}={})=>v(this,B).call(this,{type:_.CREATE_DIR,data:{path:e}},void 0,n));P(this,"listDir",(e,{signal:n}={})=>v(this,B).call(this,{type:_.LIST_DIR,data:{path:e}},void 0,n));P(this,"deleteDir",(e,{signal:n}={})=>v(this,B).call(this,{type:_.DELETE_DIR,data:{path:e}},void 0,n))}on(e,n){e==="log"?v(this,we).push(n):e==="progress"&&v(this,De).push(n)}off(e,n){e==="log"?$e(this,we,v(this,we).filter(o=>o!==n)):e==="progress"&&$e(this,De,v(this,De).filter(o=>o!==n))}}X=new WeakMap,fe=new WeakMap,te=new WeakMap,we=new WeakMap,De=new WeakMap,wt=new WeakMap,B=new WeakMap;var Qt;(function(t){t.MEMFS="MEMFS",t.NODEFS="NODEFS",t.NODERAWFS="NODERAWFS",t.IDBFS="IDBFS",t.WORKERFS="WORKERFS",t.PROXYFS="PROXYFS"})(Qt||(Qt={}));const Zn=new Error("failed to get response body reader"),Jn=new Error("failed to complete download"),Qn="Content-Length",eo=t=>new Promise((e,n)=>{const o=new FileReader;o.onload=()=>{const{result:r}=o;r instanceof ArrayBuffer?e(new Uint8Array(r)):e(new Uint8Array)},o.onerror=r=>{var i,a;n(Error(`File could not be read! Code=${((a=(i=r==null?void 0:r.target)==null?void 0:i.error)==null?void 0:a.code)||-1}`))},o.readAsArrayBuffer(t)}),ct=async t=>{let e;if(typeof t=="string")/data:_data\/([a-zA-Z]*);base64,([^"]*)/.test(t)?e=atob(t.split(",")[1]).split("").map(n=>n.charCodeAt(0)):e=await(await fetch(t)).arrayBuffer();else if(t instanceof URL)e=await(await fetch(t)).arrayBuffer();else if(t instanceof File||t instanceof Blob)e=await eo(t);else return new Uint8Array;return new Uint8Array(e)},to=async(t,e)=>{var r;const n=await fetch(t);let o;try{const i=parseInt(n.headers.get(Qn)||"-1"),a=(r=n.body)==null?void 0:r.getReader();if(!a)throw Zn;const s=[];let l=0;for(;;){const{done:u,value:g}=await a.read(),w=g?g.length:0;if(u){if(i!=-1&&i!==l)throw Jn;e&&e({url:t,total:i,received:l,delta:w,done:u});break}s.push(g),l+=w,e&&e({url:t,total:i,received:l,delta:w,done:u})}const c=new Uint8Array(l);let f=0;for(const u of s)c.set(u,f),f+=u.length;o=c.buffer}catch(i){console.log("failed to send download progress event: ",i),o=await n.arrayBuffer()}return o},Ue=async(t,e,n=!1,o)=>{const r=n?await to(t,o):await(await fetch(t)).arrayBuffer(),i=new Blob([r],{type:e});return URL.createObjectURL(i)};let S=null,Pt=!1;async function no(){if(Pt)return;if(S=new Kn,typeof SharedArrayBuffer<"u"){const e="https://unpkg.com/@ffmpeg/core-mt@0.12.6/dist/esm";await S.load({coreURL:await Ue(`${e}/ffmpeg-core.js`,"text/javascript"),wasmURL:await Ue(`${e}/ffmpeg-core.wasm`,"application/wasm"),workerURL:await Ue(`${e}/ffmpeg-core.worker.js`,"text/javascript")})}else{const e="https://unpkg.com/@ffmpeg/core@0.12.6/dist/esm";await S.load({coreURL:await Ue(`${e}/ffmpeg-core.js`,"text/javascript"),wasmURL:await Ue(`${e}/ffmpeg-core.wasm`,"application/wasm")})}Pt=!0}const oo=["zscale=t=linear:npl=100","format=gbrpf32le","zscale=p=bt709","tonemap=tonemap=hable:desat=0","zscale=t=bt709:m=bt709:r=tv","format=yuv420p","fps=30","setpts=PTS-STARTPTS"].join(","),ro="format=yuv420p,fps=30,setpts=PTS-STARTPTS";function io(t){return ao(t)}async function ao(t){try{const n=await t.slice(0,65536).arrayBuffer(),o=new Uint8Array(n),r=new TextDecoder("latin1").decode(o);return!!(r.includes("arib")||r.includes("smpt")||r.includes("bt2020"))}catch{return!1}}async function lo(t){await Wt();const e=`input_${Date.now()}.${mn(t.name,"mp4")}`,n=`trimmed_${Date.now()}.mp4`,r=await io(t)?oo:ro;await S.writeFile(e,await ct(t)),await S.exec(["-i",e,"-t","3","-c:v","libx264","-crf","26","-preset","ultrafast","-vf",r,"-colorspace","bt709","-color_primaries","bt709","-color_trc","bt709","-pix_fmt","yuv420p","-c:a","aac","-ar","44100","-af","aresample=async=1","-movflags","+faststart",n]);const i=await S.readFile(n);return await S.deleteFile(e),await S.deleteFile(n),new Blob([i.buffer],{type:"video/mp4"})}async function so(t){await Wt();const e=mn(t.name,"jpg"),n=`img_${Date.now()}.${e}`,o=`imgclip_${Date.now()}.mp4`;await S.writeFile(n,await ct(t)),await S.exec(["-loop","1","-i",n,"-t","3","-vf","scale=1280:720:force_original_aspect_ratio=decrease,pad=1280:720:(ow-iw)/2:(oh-ih)/2,format=yuv420p,fps=30,setpts=PTS-STARTPTS","-c:v","libx264","-crf","26","-preset","ultrafast","-pix_fmt","yuv420p","-colorspace","bt709","-color_primaries","bt709","-color_trc","bt709","-movflags","+faststart",o]);const r=await S.readFile(o);return await S.deleteFile(n),await S.deleteFile(o),new Blob([r.buffer],{type:"video/mp4"})}async function pn(t,e=null,n){await Wt();const o=Date.now(),r=[];for(let l=0;l<t.length;l++){const c=`clip_${o}_${l}.mp4`;await S.writeFile(c,await ct(t[l])),r.push(c),n==null||n(Math.round(l/t.length*50))}const i=`concat_${o}.txt`;await S.writeFile(i,r.map(l=>`file '${l}'`).join(`
`));const a=`merged_${o}.mp4`;if(e){const l=`video_only_${o}.mp4`;await S.exec(["-f","concat","-safe","0","-i",i,"-c","copy",l]);const c=`bgm_${o}.mp3`,f=await fetch(e).then(g=>g.blob());await S.writeFile(c,await ct(f));const u=t.length*3;await S.exec(["-i",l,"-ss","0","-i",c,"-c:v","copy","-c:a","aac","-ar","44100","-t",String(u),"-af",`afade=t=out:st=${Math.max(0,u-1.5)}:d=1.5`,"-map","0:v:0","-map","1:a:0","-movflags","+faststart",a]),await S.deleteFile(l),await S.deleteFile(c)}else await S.exec(["-f","concat","-safe","0","-i",i,"-c","copy","-movflags","+faststart",a]);n==null||n(95);const s=await S.readFile(a);for(const l of r)await S.deleteFile(l);return await S.deleteFile(i),await S.deleteFile(a),n==null||n(100),new Blob([s.buffer],{type:"video/mp4"})}async function Wt(){if(!Pt)throw new Error("FFmpeg not loaded. Call loadFFmpeg() first.")}function mn(t,e="mp4"){const n=t==null?void 0:t.split(".");return(n==null?void 0:n.length)>1?n[n.length-1].toLowerCase():e}/**!
 * Sortable 1.15.7
 * @author	RubaXa   <trash@rubaxa.org>
 * @author	owenm    <owen23355@gmail.com>
 * @license MIT
 */function co(t,e,n){return(e=po(e))in t?Object.defineProperty(t,e,{value:n,enumerable:!0,configurable:!0,writable:!0}):t[e]=n,t}function oe(){return oe=Object.assign?Object.assign.bind():function(t){for(var e=1;e<arguments.length;e++){var n=arguments[e];for(var o in n)({}).hasOwnProperty.call(n,o)&&(t[o]=n[o])}return t},oe.apply(null,arguments)}function en(t,e){var n=Object.keys(t);if(Object.getOwnPropertySymbols){var o=Object.getOwnPropertySymbols(t);e&&(o=o.filter(function(r){return Object.getOwnPropertyDescriptor(t,r).enumerable})),n.push.apply(n,o)}return n}function J(t){for(var e=1;e<arguments.length;e++){var n=arguments[e]!=null?arguments[e]:{};e%2?en(Object(n),!0).forEach(function(o){co(t,o,n[o])}):Object.getOwnPropertyDescriptors?Object.defineProperties(t,Object.getOwnPropertyDescriptors(n)):en(Object(n)).forEach(function(o){Object.defineProperty(t,o,Object.getOwnPropertyDescriptor(n,o))})}return t}function uo(t,e){if(t==null)return{};var n,o,r=fo(t,e);if(Object.getOwnPropertySymbols){var i=Object.getOwnPropertySymbols(t);for(o=0;o<i.length;o++)n=i[o],e.indexOf(n)===-1&&{}.propertyIsEnumerable.call(t,n)&&(r[n]=t[n])}return r}function fo(t,e){if(t==null)return{};var n={};for(var o in t)if({}.hasOwnProperty.call(t,o)){if(e.indexOf(o)!==-1)continue;n[o]=t[o]}return n}function ho(t,e){if(typeof t!="object"||!t)return t;var n=t[Symbol.toPrimitive];if(n!==void 0){var o=n.call(t,e);if(typeof o!="object")return o;throw new TypeError("@@toPrimitive must return a primitive value.")}return(e==="string"?String:Number)(t)}function po(t){var e=ho(t,"string");return typeof e=="symbol"?e:e+""}function Ft(t){"@babel/helpers - typeof";return Ft=typeof Symbol=="function"&&typeof Symbol.iterator=="symbol"?function(e){return typeof e}:function(e){return e&&typeof Symbol=="function"&&e.constructor===Symbol&&e!==Symbol.prototype?"symbol":typeof e},Ft(t)}var mo="1.15.7";function ne(t){if(typeof window<"u"&&window.navigator)return!!navigator.userAgent.match(t)}var re=ne(/(?:Trident.*rv[ :]?11\.|msie|iemobile|Windows Phone)/i),Ze=ne(/Edge/i),tn=ne(/firefox/i),Ye=ne(/safari/i)&&!ne(/chrome/i)&&!ne(/android/i),Xt=ne(/iP(ad|od|hone)/i),gn=ne(/chrome/i)&&ne(/android/i),vn={capture:!1,passive:!1};function y(t,e,n){t.addEventListener(e,n,!re&&vn)}function b(t,e,n){t.removeEventListener(e,n,!re&&vn)}function dt(t,e){if(e){if(e[0]===">"&&(e=e.substring(1)),t)try{if(t.matches)return t.matches(e);if(t.msMatchesSelector)return t.msMatchesSelector(e);if(t.webkitMatchesSelector)return t.webkitMatchesSelector(e)}catch{return!1}return!1}}function bn(t){return t.host&&t!==document&&t.host.nodeType&&t.host!==t?t.host:t.parentNode}function q(t,e,n,o){if(t){n=n||document;do{if(e!=null&&(e[0]===">"?t.parentNode===n&&dt(t,e):dt(t,e))||o&&t===n)return t;if(t===n)break}while(t=bn(t))}return null}var nn=/\s+/g;function j(t,e,n){if(t&&e)if(t.classList)t.classList[n?"add":"remove"](e);else{var o=(" "+t.className+" ").replace(nn," ").replace(" "+e+" "," ");t.className=(o+(n?" "+e:"")).replace(nn," ")}}function h(t,e,n){var o=t&&t.style;if(o){if(n===void 0)return document.defaultView&&document.defaultView.getComputedStyle?n=document.defaultView.getComputedStyle(t,""):t.currentStyle&&(n=t.currentStyle),e===void 0?n:n[e];!(e in o)&&e.indexOf("webkit")===-1&&(e="-webkit-"+e),o[e]=n+(typeof n=="string"?"":"px")}}function Ce(t,e){var n="";if(typeof t=="string")n=t;else do{var o=h(t,"transform");o&&o!=="none"&&(n=o+" "+n)}while(!e&&(t=t.parentNode));var r=window.DOMMatrix||window.WebKitCSSMatrix||window.CSSMatrix||window.MSCSSMatrix;return r&&new r(n)}function yn(t,e,n){if(t){var o=t.getElementsByTagName(e),r=0,i=o.length;if(n)for(;r<i;r++)n(o[r],r);return o}return[]}function Z(){var t=document.scrollingElement;return t||document.documentElement}function R(t,e,n,o,r){if(!(!t.getBoundingClientRect&&t!==window)){var i,a,s,l,c,f,u;if(t!==window&&t.parentNode&&t!==Z()?(i=t.getBoundingClientRect(),a=i.top,s=i.left,l=i.bottom,c=i.right,f=i.height,u=i.width):(a=0,s=0,l=window.innerHeight,c=window.innerWidth,f=window.innerHeight,u=window.innerWidth),(e||n)&&t!==window&&(r=r||t.parentNode,!re))do if(r&&r.getBoundingClientRect&&(h(r,"transform")!=="none"||n&&h(r,"position")!=="static")){var g=r.getBoundingClientRect();a-=g.top+parseInt(h(r,"border-top-width")),s-=g.left+parseInt(h(r,"border-left-width")),l=a+i.height,c=s+i.width;break}while(r=r.parentNode);if(o&&t!==window){var w=Ce(r||t),E=w&&w.a,D=w&&w.d;w&&(a/=D,s/=E,u/=E,f/=D,l=a+f,c=s+u)}return{top:a,left:s,bottom:l,right:c,width:u,height:f}}}function on(t,e,n){for(var o=he(t,!0),r=R(t)[e];o;){var i=R(o)[n],a=void 0;if(a=r>=i,!a)return o;if(o===Z())break;o=he(o,!1)}return!1}function Le(t,e,n,o){for(var r=0,i=0,a=t.children;i<a.length;){if(a[i].style.display!=="none"&&a[i]!==p.ghost&&(o||a[i]!==p.dragged)&&q(a[i],n.draggable,t,!1)){if(r===e)return a[i];r++}i++}return null}function Yt(t,e){for(var n=t.lastElementChild;n&&(n===p.ghost||h(n,"display")==="none"||e&&!dt(n,e));)n=n.previousElementSibling;return n||null}function Y(t,e){var n=0;if(!t||!t.parentNode)return-1;for(;t=t.previousElementSibling;)t.nodeName.toUpperCase()!=="TEMPLATE"&&t!==p.clone&&(!e||dt(t,e))&&n++;return n}function rn(t){var e=0,n=0,o=Z();if(t)do{var r=Ce(t),i=r.a,a=r.d;e+=t.scrollLeft*i,n+=t.scrollTop*a}while(t!==o&&(t=t.parentNode));return[e,n]}function go(t,e){for(var n in t)if(t.hasOwnProperty(n)){for(var o in e)if(e.hasOwnProperty(o)&&e[o]===t[n][o])return Number(n)}return-1}function he(t,e){if(!t||!t.getBoundingClientRect)return Z();var n=t,o=!1;do if(n.clientWidth<n.scrollWidth||n.clientHeight<n.scrollHeight){var r=h(n);if(n.clientWidth<n.scrollWidth&&(r.overflowX=="auto"||r.overflowX=="scroll")||n.clientHeight<n.scrollHeight&&(r.overflowY=="auto"||r.overflowY=="scroll")){if(!n.getBoundingClientRect||n===document.body)return Z();if(o||e)return n;o=!0}}while(n=n.parentNode);return Z()}function vo(t,e){if(t&&e)for(var n in e)e.hasOwnProperty(n)&&(t[n]=e[n]);return t}function St(t,e){return Math.round(t.top)===Math.round(e.top)&&Math.round(t.left)===Math.round(e.left)&&Math.round(t.height)===Math.round(e.height)&&Math.round(t.width)===Math.round(e.width)}var He;function En(t,e){return function(){if(!He){var n=arguments,o=this;n.length===1?t.call(o,n[0]):t.apply(o,n),He=setTimeout(function(){He=void 0},e)}}}function bo(){clearTimeout(He),He=void 0}function wn(t,e,n){t.scrollLeft+=e,t.scrollTop+=n}function Dn(t){var e=window.Polymer,n=window.jQuery||window.Zepto;return e&&e.dom?e.dom(t).cloneNode(!0):n?n(t).clone(!0)[0]:t.cloneNode(!0)}function _n(t,e,n){var o={};return Array.from(t.children).forEach(function(r){var i,a,s,l;if(!(!q(r,e.draggable,t,!1)||r.animated||r===n)){var c=R(r);o.left=Math.min((i=o.left)!==null&&i!==void 0?i:1/0,c.left),o.top=Math.min((a=o.top)!==null&&a!==void 0?a:1/0,c.top),o.right=Math.max((s=o.right)!==null&&s!==void 0?s:-1/0,c.right),o.bottom=Math.max((l=o.bottom)!==null&&l!==void 0?l:-1/0,c.bottom)}}),o.width=o.right-o.left,o.height=o.bottom-o.top,o.x=o.left,o.y=o.top,o}var $="Sortable"+new Date().getTime();function yo(){var t=[],e;return{captureAnimationState:function(){if(t=[],!!this.options.animation){var o=[].slice.call(this.el.children);o.forEach(function(r){if(!(h(r,"display")==="none"||r===p.ghost)){t.push({target:r,rect:R(r)});var i=J({},t[t.length-1].rect);if(r.thisAnimationDuration){var a=Ce(r,!0);a&&(i.top-=a.f,i.left-=a.e)}r.fromRect=i}})}},addAnimationState:function(o){t.push(o)},removeAnimationState:function(o){t.splice(go(t,{target:o}),1)},animateAll:function(o){var r=this;if(!this.options.animation){clearTimeout(e),typeof o=="function"&&o();return}var i=!1,a=0;t.forEach(function(s){var l=0,c=s.target,f=c.fromRect,u=R(c),g=c.prevFromRect,w=c.prevToRect,E=s.rect,D=Ce(c,!0);D&&(u.top-=D.f,u.left-=D.e),c.toRect=u,c.thisAnimationDuration&&St(g,u)&&!St(f,u)&&(E.top-u.top)/(E.left-u.left)===(f.top-u.top)/(f.left-u.left)&&(l=wo(E,g,w,r.options)),St(u,f)||(c.prevFromRect=f,c.prevToRect=u,l||(l=r.options.animation),r.animate(c,E,u,l)),l&&(i=!0,a=Math.max(a,l),clearTimeout(c.animationResetTimer),c.animationResetTimer=setTimeout(function(){c.animationTime=0,c.prevFromRect=null,c.fromRect=null,c.prevToRect=null,c.thisAnimationDuration=null},l),c.thisAnimationDuration=l)}),clearTimeout(e),i?e=setTimeout(function(){typeof o=="function"&&o()},a):typeof o=="function"&&o(),t=[]},animate:function(o,r,i,a){if(a){h(o,"transition",""),h(o,"transform","");var s=Ce(this.el),l=s&&s.a,c=s&&s.d,f=(r.left-i.left)/(l||1),u=(r.top-i.top)/(c||1);o.animatingX=!!f,o.animatingY=!!u,h(o,"transform","translate3d("+f+"px,"+u+"px,0)"),this.forRepaintDummy=Eo(o),h(o,"transition","transform "+a+"ms"+(this.options.easing?" "+this.options.easing:"")),h(o,"transform","translate3d(0,0,0)"),typeof o.animated=="number"&&clearTimeout(o.animated),o.animated=setTimeout(function(){h(o,"transition",""),h(o,"transform",""),o.animated=!1,o.animatingX=!1,o.animatingY=!1},a)}}}}function Eo(t){return t.offsetWidth}function wo(t,e,n,o){return Math.sqrt(Math.pow(e.top-t.top,2)+Math.pow(e.left-t.left,2))/Math.sqrt(Math.pow(e.top-n.top,2)+Math.pow(e.left-n.left,2))*o.animation}var Se=[],Tt={initializeByDefault:!0},Je={mount:function(e){for(var n in Tt)Tt.hasOwnProperty(n)&&!(n in e)&&(e[n]=Tt[n]);Se.forEach(function(o){if(o.pluginName===e.pluginName)throw"Sortable: Cannot mount plugin ".concat(e.pluginName," more than once")}),Se.push(e)},pluginEvent:function(e,n,o){var r=this;this.eventCanceled=!1,o.cancel=function(){r.eventCanceled=!0};var i=e+"Global";Se.forEach(function(a){n[a.pluginName]&&(n[a.pluginName][i]&&n[a.pluginName][i](J({sortable:n},o)),n.options[a.pluginName]&&n[a.pluginName][e]&&n[a.pluginName][e](J({sortable:n},o)))})},initializePlugins:function(e,n,o,r){Se.forEach(function(s){var l=s.pluginName;if(!(!e.options[l]&&!s.initializeByDefault)){var c=new s(e,n,e.options);c.sortable=e,c.options=e.options,e[l]=c,oe(o,c.defaults)}});for(var i in e.options)if(e.options.hasOwnProperty(i)){var a=this.modifyOption(e,i,e.options[i]);typeof a<"u"&&(e.options[i]=a)}},getEventProperties:function(e,n){var o={};return Se.forEach(function(r){typeof r.eventProperties=="function"&&oe(o,r.eventProperties.call(n[r.pluginName],e))}),o},modifyOption:function(e,n,o){var r;return Se.forEach(function(i){e[i.pluginName]&&i.optionListeners&&typeof i.optionListeners[n]=="function"&&(r=i.optionListeners[n].call(e[i.pluginName],o))}),r}};function Do(t){var e=t.sortable,n=t.rootEl,o=t.name,r=t.targetEl,i=t.cloneEl,a=t.toEl,s=t.fromEl,l=t.oldIndex,c=t.newIndex,f=t.oldDraggableIndex,u=t.newDraggableIndex,g=t.originalEvent,w=t.putSortable,E=t.extraEventProperties;if(e=e||n&&n[$],!!e){var D,H=e.options,Q="on"+o.charAt(0).toUpperCase()+o.substr(1);window.CustomEvent&&!re&&!Ze?D=new CustomEvent(o,{bubbles:!0,cancelable:!0}):(D=document.createEvent("Event"),D.initEvent(o,!0,!0)),D.to=a||n,D.from=s||n,D.item=r||n,D.clone=i,D.oldIndex=l,D.newIndex=c,D.oldDraggableIndex=f,D.newDraggableIndex=u,D.originalEvent=g,D.pullMode=w?w.lastPutMode:void 0;var N=J(J({},E),Je.getEventProperties(o,e));for(var z in N)D[z]=N[z];n&&n.dispatchEvent(D),H[Q]&&H[Q].call(e,D)}}var _o=["evt"],M=function(e,n){var o=arguments.length>2&&arguments[2]!==void 0?arguments[2]:{},r=o.evt,i=uo(o,_o);Je.pluginEvent.bind(p)(e,n,J({dragEl:d,parentEl:O,ghostEl:m,rootEl:T,nextEl:ye,lastDownEl:it,cloneEl:I,cloneHidden:ue,dragStarted:je,putSortable:L,activeSortable:p.active,originalEvent:r,oldIndex:Re,oldDraggableIndex:ze,newIndex:W,newDraggableIndex:ce,hideGhostForTarget:On,unhideGhostForTarget:xn,cloneNowHidden:function(){ue=!0},cloneNowShown:function(){ue=!1},dispatchSortableEvent:function(s){F({sortable:n,name:s,originalEvent:r})}},i))};function F(t){Do(J({putSortable:L,cloneEl:I,targetEl:d,rootEl:T,oldIndex:Re,oldDraggableIndex:ze,newIndex:W,newDraggableIndex:ce},t))}var d,O,m,T,ye,it,I,ue,Re,W,ze,ce,et,L,xe=!1,ut=!1,ft=[],ve,G,It,Ot,an,ln,je,Te,Ge,qe=!1,tt=!1,at,A,xt=[],Bt=!1,ht=[],Dt=typeof document<"u",nt=Xt,sn=Ze||re?"cssFloat":"float",So=Dt&&!gn&&!Xt&&"draggable"in document.createElement("div"),Sn=function(){if(Dt){if(re)return!1;var t=document.createElement("x");return t.style.cssText="pointer-events:auto",t.style.pointerEvents==="auto"}}(),Tn=function(e,n){var o=h(e),r=parseInt(o.width)-parseInt(o.paddingLeft)-parseInt(o.paddingRight)-parseInt(o.borderLeftWidth)-parseInt(o.borderRightWidth),i=Le(e,0,n),a=Le(e,1,n),s=i&&h(i),l=a&&h(a),c=s&&parseInt(s.marginLeft)+parseInt(s.marginRight)+R(i).width,f=l&&parseInt(l.marginLeft)+parseInt(l.marginRight)+R(a).width;if(o.display==="flex")return o.flexDirection==="column"||o.flexDirection==="column-reverse"?"vertical":"horizontal";if(o.display==="grid")return o.gridTemplateColumns.split(" ").length<=1?"vertical":"horizontal";if(i&&s.float&&s.float!=="none"){var u=s.float==="left"?"left":"right";return a&&(l.clear==="both"||l.clear===u)?"vertical":"horizontal"}return i&&(s.display==="block"||s.display==="flex"||s.display==="table"||s.display==="grid"||c>=r&&o[sn]==="none"||a&&o[sn]==="none"&&c+f>r)?"vertical":"horizontal"},To=function(e,n,o){var r=o?e.left:e.top,i=o?e.right:e.bottom,a=o?e.width:e.height,s=o?n.left:n.top,l=o?n.right:n.bottom,c=o?n.width:n.height;return r===s||i===l||r+a/2===s+c/2},Io=function(e,n){var o;return ft.some(function(r){var i=r[$].options.emptyInsertThreshold;if(!(!i||Yt(r))){var a=R(r),s=e>=a.left-i&&e<=a.right+i,l=n>=a.top-i&&n<=a.bottom+i;if(s&&l)return o=r}}),o},In=function(e){function n(i,a){return function(s,l,c,f){var u=s.options.group.name&&l.options.group.name&&s.options.group.name===l.options.group.name;if(i==null&&(a||u))return!0;if(i==null||i===!1)return!1;if(a&&i==="clone")return i;if(typeof i=="function")return n(i(s,l,c,f),a)(s,l,c,f);var g=(a?s:l).options.group.name;return i===!0||typeof i=="string"&&i===g||i.join&&i.indexOf(g)>-1}}var o={},r=e.group;(!r||Ft(r)!="object")&&(r={name:r}),o.name=r.name,o.checkPull=n(r.pull,!0),o.checkPut=n(r.put),o.revertClone=r.revertClone,e.group=o},On=function(){!Sn&&m&&h(m,"display","none")},xn=function(){!Sn&&m&&h(m,"display","")};Dt&&!gn&&document.addEventListener("click",function(t){if(ut)return t.preventDefault(),t.stopPropagation&&t.stopPropagation(),t.stopImmediatePropagation&&t.stopImmediatePropagation(),ut=!1,!1},!0);var be=function(e){if(d){e=e.touches?e.touches[0]:e;var n=Io(e.clientX,e.clientY);if(n){var o={};for(var r in e)e.hasOwnProperty(r)&&(o[r]=e[r]);o.target=o.rootEl=n,o.preventDefault=void 0,o.stopPropagation=void 0,n[$]._onDragOver(o)}}},Oo=function(e){d&&d.parentNode[$]._isOutsideThisEl(e.target)};function p(t,e){if(!(t&&t.nodeType&&t.nodeType===1))throw"Sortable: `el` must be an HTMLElement, not ".concat({}.toString.call(t));this.el=t,this.options=e=oe({},e),t[$]=this;var n={group:null,sort:!0,disabled:!1,store:null,handle:null,draggable:/^[uo]l$/i.test(t.nodeName)?">li":">*",swapThreshold:1,invertSwap:!1,invertedSwapThreshold:null,removeCloneOnHide:!0,direction:function(){return Tn(t,this.options)},ghostClass:"sortable-ghost",chosenClass:"sortable-chosen",dragClass:"sortable-drag",ignore:"a, img",filter:null,preventOnFilter:!0,animation:0,easing:null,setData:function(a,s){a.setData("Text",s.textContent)},dropBubble:!1,dragoverBubble:!1,dataIdAttr:"data-id",delay:0,delayOnTouchOnly:!1,touchStartThreshold:(Number.parseInt?Number:window).parseInt(window.devicePixelRatio,10)||1,forceFallback:!1,fallbackClass:"sortable-fallback",fallbackOnBody:!1,fallbackTolerance:0,fallbackOffset:{x:0,y:0},supportPointer:p.supportPointer!==!1&&"PointerEvent"in window&&(!Ye||Xt),emptyInsertThreshold:5};Je.initializePlugins(this,t,n);for(var o in n)!(o in e)&&(e[o]=n[o]);In(e);for(var r in this)r.charAt(0)==="_"&&typeof this[r]=="function"&&(this[r]=this[r].bind(this));this.nativeDraggable=e.forceFallback?!1:So,this.nativeDraggable&&(this.options.touchStartThreshold=1),e.supportPointer?y(t,"pointerdown",this._onTapStart):(y(t,"mousedown",this._onTapStart),y(t,"touchstart",this._onTapStart)),this.nativeDraggable&&(y(t,"dragover",this),y(t,"dragenter",this)),ft.push(this.el),e.store&&e.store.get&&this.sort(e.store.get(this)||[]),oe(this,yo())}p.prototype={constructor:p,_isOutsideThisEl:function(e){!this.el.contains(e)&&e!==this.el&&(Te=null)},_getDirection:function(e,n){return typeof this.options.direction=="function"?this.options.direction.call(this,e,n,d):this.options.direction},_onTapStart:function(e){if(e.cancelable){var n=this,o=this.el,r=this.options,i=r.preventOnFilter,a=e.type,s=e.touches&&e.touches[0]||e.pointerType&&e.pointerType==="touch"&&e,l=(s||e).target,c=e.target.shadowRoot&&(e.path&&e.path[0]||e.composedPath&&e.composedPath()[0])||l,f=r.filter;if(Fo(o),!d&&!(/mousedown|pointerdown/.test(a)&&e.button!==0||r.disabled)&&!c.isContentEditable&&!(!this.nativeDraggable&&Ye&&l&&l.tagName.toUpperCase()==="SELECT")&&(l=q(l,r.draggable,o,!1),!(l&&l.animated)&&it!==l)){if(Re=Y(l),ze=Y(l,r.draggable),typeof f=="function"){if(f.call(this,e,l,this)){F({sortable:n,rootEl:c,name:"filter",targetEl:l,toEl:o,fromEl:o}),M("filter",n,{evt:e}),i&&e.preventDefault();return}}else if(f&&(f=f.split(",").some(function(u){if(u=q(c,u.trim(),o,!1),u)return F({sortable:n,rootEl:u,name:"filter",targetEl:l,fromEl:o,toEl:o}),M("filter",n,{evt:e}),!0}),f)){i&&e.preventDefault();return}r.handle&&!q(c,r.handle,o,!1)||this._prepareDragStart(e,s,l)}}},_prepareDragStart:function(e,n,o){var r=this,i=r.el,a=r.options,s=i.ownerDocument,l;if(o&&!d&&o.parentNode===i){var c=R(o);if(T=i,d=o,O=d.parentNode,ye=d.nextSibling,it=o,et=a.group,p.dragged=d,ve={target:d,clientX:(n||e).clientX,clientY:(n||e).clientY},an=ve.clientX-c.left,ln=ve.clientY-c.top,this._lastX=(n||e).clientX,this._lastY=(n||e).clientY,d.style["will-change"]="all",l=function(){if(M("delayEnded",r,{evt:e}),p.eventCanceled){r._onDrop();return}r._disableDelayedDragEvents(),!tn&&r.nativeDraggable&&(d.draggable=!0),r._triggerDragStart(e,n),F({sortable:r,name:"choose",originalEvent:e}),j(d,a.chosenClass,!0)},a.ignore.split(",").forEach(function(f){yn(d,f.trim(),Rt)}),y(s,"dragover",be),y(s,"mousemove",be),y(s,"touchmove",be),a.supportPointer?(y(s,"pointerup",r._onDrop),!this.nativeDraggable&&y(s,"pointercancel",r._onDrop)):(y(s,"mouseup",r._onDrop),y(s,"touchend",r._onDrop),y(s,"touchcancel",r._onDrop)),tn&&this.nativeDraggable&&(this.options.touchStartThreshold=4,d.draggable=!0),M("delayStart",this,{evt:e}),a.delay&&(!a.delayOnTouchOnly||n)&&(!this.nativeDraggable||!(Ze||re))){if(p.eventCanceled){this._onDrop();return}a.supportPointer?(y(s,"pointerup",r._disableDelayedDrag),y(s,"pointercancel",r._disableDelayedDrag)):(y(s,"mouseup",r._disableDelayedDrag),y(s,"touchend",r._disableDelayedDrag),y(s,"touchcancel",r._disableDelayedDrag)),y(s,"mousemove",r._delayedDragTouchMoveHandler),y(s,"touchmove",r._delayedDragTouchMoveHandler),a.supportPointer&&y(s,"pointermove",r._delayedDragTouchMoveHandler),r._dragStartTimer=setTimeout(l,a.delay)}else l()}},_delayedDragTouchMoveHandler:function(e){var n=e.touches?e.touches[0]:e;Math.max(Math.abs(n.clientX-this._lastX),Math.abs(n.clientY-this._lastY))>=Math.floor(this.options.touchStartThreshold/(this.nativeDraggable&&window.devicePixelRatio||1))&&this._disableDelayedDrag()},_disableDelayedDrag:function(){d&&Rt(d),clearTimeout(this._dragStartTimer),this._disableDelayedDragEvents()},_disableDelayedDragEvents:function(){var e=this.el.ownerDocument;b(e,"mouseup",this._disableDelayedDrag),b(e,"touchend",this._disableDelayedDrag),b(e,"touchcancel",this._disableDelayedDrag),b(e,"pointerup",this._disableDelayedDrag),b(e,"pointercancel",this._disableDelayedDrag),b(e,"mousemove",this._delayedDragTouchMoveHandler),b(e,"touchmove",this._delayedDragTouchMoveHandler),b(e,"pointermove",this._delayedDragTouchMoveHandler)},_triggerDragStart:function(e,n){n=n||e.pointerType=="touch"&&e,!this.nativeDraggable||n?this.options.supportPointer?y(document,"pointermove",this._onTouchMove):n?y(document,"touchmove",this._onTouchMove):y(document,"mousemove",this._onTouchMove):(y(d,"dragend",this),y(T,"dragstart",this._onDragStart));try{document.selection?lt(function(){document.selection.empty()}):window.getSelection().removeAllRanges()}catch{}},_dragStarted:function(e,n){if(xe=!1,T&&d){M("dragStarted",this,{evt:n}),this.nativeDraggable&&y(document,"dragover",Oo);var o=this.options;!e&&j(d,o.dragClass,!1),j(d,o.ghostClass,!0),p.active=this,e&&this._appendGhost(),F({sortable:this,name:"start",originalEvent:n})}else this._nulling()},_emulateDragOver:function(){if(G){this._lastX=G.clientX,this._lastY=G.clientY,On();for(var e=document.elementFromPoint(G.clientX,G.clientY),n=e;e&&e.shadowRoot&&(e=e.shadowRoot.elementFromPoint(G.clientX,G.clientY),e!==n);)n=e;if(d.parentNode[$]._isOutsideThisEl(e),n)do{if(n[$]){var o=void 0;if(o=n[$]._onDragOver({clientX:G.clientX,clientY:G.clientY,target:e,rootEl:n}),o&&!this.options.dragoverBubble)break}e=n}while(n=bn(n));xn()}},_onTouchMove:function(e){if(ve){var n=this.options,o=n.fallbackTolerance,r=n.fallbackOffset,i=e.touches?e.touches[0]:e,a=m&&Ce(m,!0),s=m&&a&&a.a,l=m&&a&&a.d,c=nt&&A&&rn(A),f=(i.clientX-ve.clientX+r.x)/(s||1)+(c?c[0]-xt[0]:0)/(s||1),u=(i.clientY-ve.clientY+r.y)/(l||1)+(c?c[1]-xt[1]:0)/(l||1);if(!p.active&&!xe){if(o&&Math.max(Math.abs(i.clientX-this._lastX),Math.abs(i.clientY-this._lastY))<o)return;this._onDragStart(e,!0)}if(m){a?(a.e+=f-(It||0),a.f+=u-(Ot||0)):a={a:1,b:0,c:0,d:1,e:f,f:u};var g="matrix(".concat(a.a,",").concat(a.b,",").concat(a.c,",").concat(a.d,",").concat(a.e,",").concat(a.f,")");h(m,"webkitTransform",g),h(m,"mozTransform",g),h(m,"msTransform",g),h(m,"transform",g),It=f,Ot=u,G=i}e.cancelable&&e.preventDefault()}},_appendGhost:function(){if(!m){var e=this.options.fallbackOnBody?document.body:T,n=R(d,!0,nt,!0,e),o=this.options;if(nt){for(A=e;h(A,"position")==="static"&&h(A,"transform")==="none"&&A!==document;)A=A.parentNode;A!==document.body&&A!==document.documentElement?(A===document&&(A=Z()),n.top+=A.scrollTop,n.left+=A.scrollLeft):A=Z(),xt=rn(A)}m=d.cloneNode(!0),j(m,o.ghostClass,!1),j(m,o.fallbackClass,!0),j(m,o.dragClass,!0),h(m,"transition",""),h(m,"transform",""),h(m,"box-sizing","border-box"),h(m,"margin",0),h(m,"top",n.top),h(m,"left",n.left),h(m,"width",n.width),h(m,"height",n.height),h(m,"opacity","0.8"),h(m,"position",nt?"absolute":"fixed"),h(m,"zIndex","100000"),h(m,"pointerEvents","none"),p.ghost=m,e.appendChild(m),h(m,"transform-origin",an/parseInt(m.style.width)*100+"% "+ln/parseInt(m.style.height)*100+"%")}},_onDragStart:function(e,n){var o=this,r=e.dataTransfer,i=o.options;if(M("dragStart",this,{evt:e}),p.eventCanceled){this._onDrop();return}M("setupClone",this),p.eventCanceled||(I=Dn(d),I.removeAttribute("id"),I.draggable=!1,I.style["will-change"]="",this._hideClone(),j(I,this.options.chosenClass,!1),p.clone=I),o.cloneId=lt(function(){M("clone",o),!p.eventCanceled&&(o.options.removeCloneOnHide||T.insertBefore(I,d),o._hideClone(),F({sortable:o,name:"clone"}))}),!n&&j(d,i.dragClass,!0),n?(ut=!0,o._loopId=setInterval(o._emulateDragOver,50)):(b(document,"mouseup",o._onDrop),b(document,"touchend",o._onDrop),b(document,"touchcancel",o._onDrop),r&&(r.effectAllowed="move",i.setData&&i.setData.call(o,r,d)),y(document,"drop",o),h(d,"transform","translateZ(0)")),xe=!0,o._dragStartId=lt(o._dragStarted.bind(o,n,e)),y(document,"selectstart",o),je=!0,window.getSelection().removeAllRanges(),Ye&&h(document.body,"user-select","none")},_onDragOver:function(e){var n=this.el,o=e.target,r,i,a,s=this.options,l=s.group,c=p.active,f=et===l,u=s.sort,g=L||c,w,E=this,D=!1;if(Bt)return;function H(Me,Xn){M(Me,E,J({evt:e,isOwner:f,axis:w?"vertical":"horizontal",revert:a,dragRect:r,targetRect:i,canSort:u,fromSortable:g,target:o,completed:N,onMove:function(Kt,Yn){return ot(T,n,d,r,Kt,R(Kt),e,Yn)},changed:z},Xn))}function Q(){H("dragOverAnimationCapture"),E.captureAnimationState(),E!==g&&g.captureAnimationState()}function N(Me){return H("dragOverCompleted",{insertion:Me}),Me&&(f?c._hideClone():c._showClone(E),E!==g&&(j(d,L?L.options.ghostClass:c.options.ghostClass,!1),j(d,s.ghostClass,!0)),L!==E&&E!==p.active?L=E:E===p.active&&L&&(L=null),g===E&&(E._ignoreWhileAnimating=o),E.animateAll(function(){H("dragOverAnimationComplete"),E._ignoreWhileAnimating=null}),E!==g&&(g.animateAll(),g._ignoreWhileAnimating=null)),(o===d&&!d.animated||o===n&&!o.animated)&&(Te=null),!s.dragoverBubble&&!e.rootEl&&o!==document&&(d.parentNode[$]._isOutsideThisEl(e.target),!Me&&be(e)),!s.dragoverBubble&&e.stopPropagation&&e.stopPropagation(),D=!0}function z(){W=Y(d),ce=Y(d,s.draggable),F({sortable:E,name:"change",toEl:n,newIndex:W,newDraggableIndex:ce,originalEvent:e})}if(e.preventDefault!==void 0&&e.cancelable&&e.preventDefault(),o=q(o,s.draggable,n,!0),H("dragOver"),p.eventCanceled)return D;if(d.contains(e.target)||o.animated&&o.animatingX&&o.animatingY||E._ignoreWhileAnimating===o)return N(!1);if(ut=!1,c&&!s.disabled&&(f?u||(a=O!==T):L===this||(this.lastPutMode=et.checkPull(this,c,d,e))&&l.checkPut(this,c,d,e))){if(w=this._getDirection(e,o)==="vertical",r=R(d),H("dragOverValid"),p.eventCanceled)return D;if(a)return O=T,Q(),this._hideClone(),H("revert"),p.eventCanceled||(ye?T.insertBefore(d,ye):T.appendChild(d)),N(!0);var U=Yt(n,s.draggable);if(!U||Lo(e,w,this)&&!U.animated){if(U===d)return N(!1);if(U&&n===e.target&&(o=U),o&&(i=R(o)),ot(T,n,d,r,o,i,e,!!o)!==!1)return Q(),U&&U.nextSibling?n.insertBefore(d,U.nextSibling):n.appendChild(d),O=n,z(),N(!0)}else if(U&&Co(e,w,this)){var pe=Le(n,0,s,!0);if(pe===d)return N(!1);if(o=pe,i=R(o),ot(T,n,d,r,o,i,e,!1)!==!1)return Q(),n.insertBefore(d,pe),O=n,z(),N(!0)}else if(o.parentNode===n){i=R(o);var V=0,me,Ne=d.parentNode!==n,k=!To(d.animated&&d.toRect||r,o.animated&&o.toRect||i,w),Pe=w?"top":"left",ie=on(o,"top","top")||on(d,"top","top"),Fe=ie?ie.scrollTop:void 0;Te!==o&&(me=i[Pe],qe=!1,tt=!k&&s.invertSwap||Ne),V=Ao(e,o,i,w,k?1:s.swapThreshold,s.invertedSwapThreshold==null?s.swapThreshold:s.invertedSwapThreshold,tt,Te===o);var ee;if(V!==0){var ge=Y(d);do ge-=V,ee=O.children[ge];while(ee&&(h(ee,"display")==="none"||ee===m))}if(V===0||ee===o)return N(!1);Te=o,Ge=V;var Be=o.nextElementSibling,ae=!1;ae=V===1;var Qe=ot(T,n,d,r,o,i,e,ae);if(Qe!==!1)return(Qe===1||Qe===-1)&&(ae=Qe===1),Bt=!0,setTimeout(Ro,30),Q(),ae&&!Be?n.appendChild(d):o.parentNode.insertBefore(d,ae?Be:o),ie&&wn(ie,0,Fe-ie.scrollTop),O=d.parentNode,me!==void 0&&!tt&&(at=Math.abs(me-R(o)[Pe])),z(),N(!0)}if(n.contains(d))return N(!1)}return!1},_ignoreWhileAnimating:null,_offMoveEvents:function(){b(document,"mousemove",this._onTouchMove),b(document,"touchmove",this._onTouchMove),b(document,"pointermove",this._onTouchMove),b(document,"dragover",be),b(document,"mousemove",be),b(document,"touchmove",be)},_offUpEvents:function(){var e=this.el.ownerDocument;b(e,"mouseup",this._onDrop),b(e,"touchend",this._onDrop),b(e,"pointerup",this._onDrop),b(e,"pointercancel",this._onDrop),b(e,"touchcancel",this._onDrop),b(document,"selectstart",this)},_onDrop:function(e){var n=this.el,o=this.options;if(W=Y(d),ce=Y(d,o.draggable),M("drop",this,{evt:e}),O=d&&d.parentNode,W=Y(d),ce=Y(d,o.draggable),p.eventCanceled){this._nulling();return}xe=!1,tt=!1,qe=!1,clearInterval(this._loopId),clearTimeout(this._dragStartTimer),Mt(this.cloneId),Mt(this._dragStartId),this.nativeDraggable&&(b(document,"drop",this),b(n,"dragstart",this._onDragStart)),this._offMoveEvents(),this._offUpEvents(),Ye&&h(document.body,"user-select",""),h(d,"transform",""),e&&(je&&(e.cancelable&&e.preventDefault(),!o.dropBubble&&e.stopPropagation()),m&&m.parentNode&&m.parentNode.removeChild(m),(T===O||L&&L.lastPutMode!=="clone")&&I&&I.parentNode&&I.parentNode.removeChild(I),d&&(this.nativeDraggable&&b(d,"dragend",this),Rt(d),d.style["will-change"]="",je&&!xe&&j(d,L?L.options.ghostClass:this.options.ghostClass,!1),j(d,this.options.chosenClass,!1),F({sortable:this,name:"unchoose",toEl:O,newIndex:null,newDraggableIndex:null,originalEvent:e}),T!==O?(W>=0&&(F({rootEl:O,name:"add",toEl:O,fromEl:T,originalEvent:e}),F({sortable:this,name:"remove",toEl:O,originalEvent:e}),F({rootEl:O,name:"sort",toEl:O,fromEl:T,originalEvent:e}),F({sortable:this,name:"sort",toEl:O,originalEvent:e})),L&&L.save()):W!==Re&&W>=0&&(F({sortable:this,name:"update",toEl:O,originalEvent:e}),F({sortable:this,name:"sort",toEl:O,originalEvent:e})),p.active&&((W==null||W===-1)&&(W=Re,ce=ze),F({sortable:this,name:"end",toEl:O,originalEvent:e}),this.save()))),this._nulling()},_nulling:function(){M("nulling",this),T=d=O=m=ye=I=it=ue=ve=G=je=W=ce=Re=ze=Te=Ge=L=et=p.dragged=p.ghost=p.clone=p.active=null;var e=this.el;ht.forEach(function(n){e.contains(n)&&(n.checked=!0)}),ht.length=It=Ot=0},handleEvent:function(e){switch(e.type){case"drop":case"dragend":this._onDrop(e);break;case"dragenter":case"dragover":d&&(this._onDragOver(e),xo(e));break;case"selectstart":e.preventDefault();break}},toArray:function(){for(var e=[],n,o=this.el.children,r=0,i=o.length,a=this.options;r<i;r++)n=o[r],q(n,a.draggable,this.el,!1)&&e.push(n.getAttribute(a.dataIdAttr)||Po(n));return e},sort:function(e,n){var o={},r=this.el;this.toArray().forEach(function(i,a){var s=r.children[a];q(s,this.options.draggable,r,!1)&&(o[i]=s)},this),n&&this.captureAnimationState(),e.forEach(function(i){o[i]&&(r.removeChild(o[i]),r.appendChild(o[i]))}),n&&this.animateAll()},save:function(){var e=this.options.store;e&&e.set&&e.set(this)},closest:function(e,n){return q(e,n||this.options.draggable,this.el,!1)},option:function(e,n){var o=this.options;if(n===void 0)return o[e];var r=Je.modifyOption(this,e,n);typeof r<"u"?o[e]=r:o[e]=n,e==="group"&&In(o)},destroy:function(){M("destroy",this);var e=this.el;e[$]=null,b(e,"mousedown",this._onTapStart),b(e,"touchstart",this._onTapStart),b(e,"pointerdown",this._onTapStart),this.nativeDraggable&&(b(e,"dragover",this),b(e,"dragenter",this)),Array.prototype.forEach.call(e.querySelectorAll("[draggable]"),function(n){n.removeAttribute("draggable")}),this._onDrop(),this._disableDelayedDragEvents(),ft.splice(ft.indexOf(this.el),1),this.el=e=null},_hideClone:function(){if(!ue){if(M("hideClone",this),p.eventCanceled)return;h(I,"display","none"),this.options.removeCloneOnHide&&I.parentNode&&I.parentNode.removeChild(I),ue=!0}},_showClone:function(e){if(e.lastPutMode!=="clone"){this._hideClone();return}if(ue){if(M("showClone",this),p.eventCanceled)return;d.parentNode==T&&!this.options.group.revertClone?T.insertBefore(I,d):ye?T.insertBefore(I,ye):T.appendChild(I),this.options.group.revertClone&&this.animate(d,I),h(I,"display",""),ue=!1}}};function xo(t){t.dataTransfer&&(t.dataTransfer.dropEffect="move"),t.cancelable&&t.preventDefault()}function ot(t,e,n,o,r,i,a,s){var l,c=t[$],f=c.options.onMove,u;return window.CustomEvent&&!re&&!Ze?l=new CustomEvent("move",{bubbles:!0,cancelable:!0}):(l=document.createEvent("Event"),l.initEvent("move",!0,!0)),l.to=e,l.from=t,l.dragged=n,l.draggedRect=o,l.related=r||e,l.relatedRect=i||R(e),l.willInsertAfter=s,l.originalEvent=a,t.dispatchEvent(l),f&&(u=f.call(c,l,a)),u}function Rt(t){t.draggable=!1}function Ro(){Bt=!1}function Co(t,e,n){var o=R(Le(n.el,0,n.options,!0)),r=_n(n.el,n.options,m),i=10;return e?t.clientX<r.left-i||t.clientY<o.top&&t.clientX<o.right:t.clientY<r.top-i||t.clientY<o.bottom&&t.clientX<o.left}function Lo(t,e,n){var o=R(Yt(n.el,n.options.draggable)),r=_n(n.el,n.options,m),i=10;return e?t.clientX>r.right+i||t.clientY>o.bottom&&t.clientX>o.left:t.clientY>r.bottom+i||t.clientX>o.right&&t.clientY>o.top}function Ao(t,e,n,o,r,i,a,s){var l=o?t.clientY:t.clientX,c=o?n.height:n.width,f=o?n.top:n.left,u=o?n.bottom:n.right,g=!1;if(!a){if(s&&at<c*r){if(!qe&&(Ge===1?l>f+c*i/2:l<u-c*i/2)&&(qe=!0),qe)g=!0;else if(Ge===1?l<f+at:l>u-at)return-Ge}else if(l>f+c*(1-r)/2&&l<u-c*(1-r)/2)return No(e)}return g=g||a,g&&(l<f+c*i/2||l>u-c*i/2)?l>f+c/2?1:-1:0}function No(t){return Y(d)<Y(t)?1:-1}function Po(t){for(var e=t.tagName+t.className+t.src+t.href+t.textContent,n=e.length,o=0;n--;)o+=e.charCodeAt(n);return o.toString(36)}function Fo(t){ht.length=0;for(var e=t.getElementsByTagName("input"),n=e.length;n--;){var o=e[n];o.checked&&ht.push(o)}}function lt(t){return setTimeout(t,0)}function Mt(t){return clearTimeout(t)}Dt&&y(document,"touchmove",function(t){(p.active||xe)&&t.cancelable&&t.preventDefault()});p.utils={on:y,off:b,css:h,find:yn,is:function(e,n){return!!q(e,n,e,!1)},extend:vo,throttle:En,closest:q,toggleClass:j,clone:Dn,index:Y,nextTick:lt,cancelNextTick:Mt,detectDirection:Tn,getChild:Le,expando:$};p.get=function(t){return t[$]};p.mount=function(){for(var t=arguments.length,e=new Array(t),n=0;n<t;n++)e[n]=arguments[n];e[0].constructor===Array&&(e=e[0]),e.forEach(function(o){if(!o.prototype||!o.prototype.constructor)throw"Sortable: Mounted plugin must be a constructor function, not ".concat({}.toString.call(o));o.utils&&(p.utils=J(J({},p.utils),o.utils)),Je.mount(o)})};p.create=function(t,e){return new p(t,e)};p.version=mo;var x=[],We,$t,Ut=!1,Ct,Lt,pt,Xe;function Bo(){function t(){this.defaults={scroll:!0,forceAutoScrollFallback:!1,scrollSensitivity:30,scrollSpeed:10,bubbleScroll:!0};for(var e in this)e.charAt(0)==="_"&&typeof this[e]=="function"&&(this[e]=this[e].bind(this))}return t.prototype={dragStarted:function(n){var o=n.originalEvent;this.sortable.nativeDraggable?y(document,"dragover",this._handleAutoScroll):this.options.supportPointer?y(document,"pointermove",this._handleFallbackAutoScroll):o.touches?y(document,"touchmove",this._handleFallbackAutoScroll):y(document,"mousemove",this._handleFallbackAutoScroll)},dragOverCompleted:function(n){var o=n.originalEvent;!this.options.dragOverBubble&&!o.rootEl&&this._handleAutoScroll(o)},drop:function(){this.sortable.nativeDraggable?b(document,"dragover",this._handleAutoScroll):(b(document,"pointermove",this._handleFallbackAutoScroll),b(document,"touchmove",this._handleFallbackAutoScroll),b(document,"mousemove",this._handleFallbackAutoScroll)),cn(),st(),bo()},nulling:function(){pt=$t=We=Ut=Xe=Ct=Lt=null,x.length=0},_handleFallbackAutoScroll:function(n){this._handleAutoScroll(n,!0)},_handleAutoScroll:function(n,o){var r=this,i=(n.touches?n.touches[0]:n).clientX,a=(n.touches?n.touches[0]:n).clientY,s=document.elementFromPoint(i,a);if(pt=n,o||this.options.forceAutoScrollFallback||Ze||re||Ye){At(n,this.options,s,o);var l=he(s,!0);Ut&&(!Xe||i!==Ct||a!==Lt)&&(Xe&&cn(),Xe=setInterval(function(){var c=he(document.elementFromPoint(i,a),!0);c!==l&&(l=c,st()),At(n,r.options,c,o)},10),Ct=i,Lt=a)}else{if(!this.options.bubbleScroll||he(s,!0)===Z()){st();return}At(n,this.options,he(s,!1),!1)}}},oe(t,{pluginName:"scroll",initializeByDefault:!0})}function st(){x.forEach(function(t){clearInterval(t.pid)}),x=[]}function cn(){clearInterval(Xe)}var At=En(function(t,e,n,o){if(e.scroll){var r=(t.touches?t.touches[0]:t).clientX,i=(t.touches?t.touches[0]:t).clientY,a=e.scrollSensitivity,s=e.scrollSpeed,l=Z(),c=!1,f;$t!==n&&($t=n,st(),We=e.scroll,f=e.scrollFn,We===!0&&(We=he(n,!0)));var u=0,g=We;do{var w=g,E=R(w),D=E.top,H=E.bottom,Q=E.left,N=E.right,z=E.width,U=E.height,pe=void 0,V=void 0,me=w.scrollWidth,Ne=w.scrollHeight,k=h(w),Pe=w.scrollLeft,ie=w.scrollTop;w===l?(pe=z<me&&(k.overflowX==="auto"||k.overflowX==="scroll"||k.overflowX==="visible"),V=U<Ne&&(k.overflowY==="auto"||k.overflowY==="scroll"||k.overflowY==="visible")):(pe=z<me&&(k.overflowX==="auto"||k.overflowX==="scroll"),V=U<Ne&&(k.overflowY==="auto"||k.overflowY==="scroll"));var Fe=pe&&(Math.abs(N-r)<=a&&Pe+z<me)-(Math.abs(Q-r)<=a&&!!Pe),ee=V&&(Math.abs(H-i)<=a&&ie+U<Ne)-(Math.abs(D-i)<=a&&!!ie);if(!x[u])for(var ge=0;ge<=u;ge++)x[ge]||(x[ge]={});(x[u].vx!=Fe||x[u].vy!=ee||x[u].el!==w)&&(x[u].el=w,x[u].vx=Fe,x[u].vy=ee,clearInterval(x[u].pid),(Fe!=0||ee!=0)&&(c=!0,x[u].pid=setInterval((function(){o&&this.layer===0&&p.active._onTouchMove(pt);var Be=x[this.layer].vy?x[this.layer].vy*s:0,ae=x[this.layer].vx?x[this.layer].vx*s:0;typeof f=="function"&&f.call(p.dragged.parentNode[$],ae,Be,t,pt,x[this.layer].el)!=="continue"||wn(x[this.layer].el,ae,Be)}).bind({layer:u}),24))),u++}while(e.bubbleScroll&&g!==l&&(g=he(g,!1)));Ut=c}},30),Rn=function(e){var n=e.originalEvent,o=e.putSortable,r=e.dragEl,i=e.activeSortable,a=e.dispatchSortableEvent,s=e.hideGhostForTarget,l=e.unhideGhostForTarget;if(n){var c=o||i;s();var f=n.changedTouches&&n.changedTouches.length?n.changedTouches[0]:n,u=document.elementFromPoint(f.clientX,f.clientY);l(),c&&!c.el.contains(u)&&(a("spill"),this.onSpill({dragEl:r,putSortable:o}))}};function Ht(){}Ht.prototype={startIndex:null,dragStart:function(e){var n=e.oldDraggableIndex;this.startIndex=n},onSpill:function(e){var n=e.dragEl,o=e.putSortable;this.sortable.captureAnimationState(),o&&o.captureAnimationState();var r=Le(this.sortable.el,this.startIndex,this.options);r?this.sortable.el.insertBefore(n,r):this.sortable.el.appendChild(n),this.sortable.animateAll(),o&&o.animateAll()},drop:Rn};oe(Ht,{pluginName:"revertOnSpill"});function zt(){}zt.prototype={onSpill:function(e){var n=e.dragEl,o=e.putSortable,r=o||this.sortable;r.captureAnimationState(),n.parentNode&&n.parentNode.removeChild(n),r.animateAll()},drop:Rn};oe(zt,{pluginName:"removeOnSpill"});p.mount(new Bo);p.mount(zt,Ht);const Ae=20,Cn=3;function ke(...t){const e=t.join(" ");console.log("[editor]",e);const n=document.getElementById("dbg-panel");if(n){const o=document.createElement("div");o.textContent=`[editor] ${e}`,n.appendChild(o),n.scrollTop=n.scrollHeight}}let C=[],K=null;function Mo(t){K=t;const e=document.getElementById("clip-tray");p.create(e,{animation:150,ghostClass:"sortable-ghost",filter:".tray-empty",delay:150,delayOnTouchOnly:!0,touchStartThreshold:5,onEnd(){const n=e.querySelectorAll(".clip-card"),o=[];n.forEach(r=>{const i=C.find(a=>a.id===r.dataset.id);i&&o.push(i)}),C=o,Wo(),K==null||K(C)}})}function Gt(t){if(ke(`addClip called: ${t.name}, clipsÁèæÂú®=${C.length}`),C.length>=Ae)return ke("MAXË∂ÖÈÅé"),!1;C.push(t),ke(`clipsËøΩÂä†Âæå=${C.length}„ÄÅrenderTrayÈñãÂßã`);try{Ln(),ke("renderTrayÂÆå‰∫Ü")}catch(e){ke(`renderTray„Ç®„É©„Éº: ${e.message}`)}return K==null||K(C),!0}function $o(t){var e;URL.revokeObjectURL((e=C.find(n=>n.id===t))==null?void 0:e.thumbUrl),C=C.filter(n=>n.id!==t),Ln(),K==null||K(C)}function _t(){return C}function Uo(t,e){const n=C.find(i=>i.id===t);if(!n)return;n.thumbUrl=e;const o=document.querySelector(`.clip-card[data-id="${t}"]`);if(!o)return;const r=o.querySelector(".clip-thumb-img, .clip-thumb-placeholder");if(r&&e){const i=document.createElement("img");i.className="clip-thumb-img",i.src=e,i.alt="clip",r.replaceWith(i)}}function ko(){return C.length*Cn}function Ln(){const t=document.getElementById("clip-tray"),e=document.getElementById("tray-empty");if(t.querySelectorAll(".clip-card").forEach(n=>n.remove()),C.length===0){e.style.display="flex";return}e.style.display="none",C.forEach((n,o)=>{t.appendChild(jo(n,o+1))}),An()}function jo(t,e){const n=document.createElement("div");n.className="clip-card",n.dataset.id=t.id;const o=t.thumbUrl?`<img class="clip-thumb-img" src="${t.thumbUrl}" alt="clip" />`:'<div class="clip-thumb-img clip-thumb-placeholder">üé¨</div>';return n.innerHTML=`
    ${o}
    <span class="clip-index">${e}</span>
    <span class="clip-type-badge">${t.type==="image"?"üì∑":"üé¨"}</span>
    <button class="clip-delete" data-id="${t.id}" title="ÂâäÈô§">‚úï</button>
    <div class="clip-duration">${Cn}s</div>
  `,n.querySelector(".clip-delete").addEventListener("click",r=>{r.stopPropagation(),$o(t.id)}),n}function Wo(){document.querySelectorAll(".clip-card").forEach((e,n)=>{const o=e.querySelector(".clip-index");o&&(o.textContent=n+1)}),An()}function An(){const t=document.getElementById("clip-counter"),e=document.getElementById("total-duration"),n=document.getElementById("clip-count-label"),o=ko();t.textContent=`${C.length} / ${Ae}`,e.textContent=o>=60?`${Math.floor(o/60)}ÂàÜ${o%60>0?o%60+"Áßí":""}`:`${o}Áßí`,n.textContent=`${C.length}„ÇØ„É™„ÉÉ„Éó`}const Xo=3e3;let _e=null,se=null;async function Nn(t,e,n){try{_e=await navigator.mediaDevices.getUserMedia({video:!0,audio:!0}),t.srcObject=_e,n.disabled=!1,e.textContent="„Ç´„É°„É©„ÅåËµ∑Âãï„Åó„Åæ„Åó„Åü„ÄÇÊ∫ñÂÇô„Åå„Åß„Åç„Åü„Çâ„ÄåÊíÆÂΩ±ÈñãÂßã„Äç„ÇíÊäº„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ"}catch(o){console.error("Camera error:",o),e.textContent="„Ç´„É°„É©„Å∏„ÅÆ„Ç¢„ÇØ„Çª„Çπ„ÅåÊãíÂê¶„Åï„Çå„Åæ„Åó„Åü„ÄÇ„Éñ„É©„Ç¶„Ç∂„ÅÆË®≠ÂÆö„ÇíÁ¢∫Ë™ç„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ",n.disabled=!0}}function Yo(){_e&&(_e.getTracks().forEach(t=>t.stop()),_e=null)}function Ho(t,e){return new Promise((n,o)=>{if(!_e){o(new Error("Camera not initialized"));return}const r=[],i=zo();se=new MediaRecorder(_e,i?{mimeType:i}:{}),se.ondataavailable=l=>{l.data.size>0&&r.push(l.data)},se.onstop=()=>{const l=new Blob(r,{type:i||"video/webm"});n(l)},se.onerror=l=>o(l.error);let a=3;e.textContent=a,e.classList.remove("hidden");const s=setInterval(()=>{a--,a>0?e.textContent=a:(clearInterval(s),e.classList.add("hidden"),se.stop())},1e3);se.start(),setTimeout(()=>{se.state==="recording"&&se.stop()},Xo+100)})}function zo(){return["video/webm;codecs=vp9,opus","video/webm;codecs=vp8,opus","video/webm","video/mp4"].find(e=>MediaRecorder.isTypeSupported(e))||""}function qt(){return typeof crypto<"u"&&crypto.randomUUID?crypto.randomUUID():"xxxxxxxx-xxxx-4xxx-yxxx-xxxxxxxxxxxx".replace(/[xy]/g,t=>{const e=Math.random()*16|0;return(t==="x"?e:e&3|8).toString(16)})}const kt=document.getElementById("btn-camera"),jt=document.getElementById("btn-upload"),dn=document.getElementById("panel-camera"),un=document.getElementById("panel-upload"),Vt=document.getElementById("camera-preview"),Go=document.getElementById("countdown"),Ee=document.getElementById("btn-record"),Pn=document.querySelector("#panel-camera .hint"),Ie=document.getElementById("drop-zone"),Fn=document.getElementById("file-input"),Bn=document.getElementById("btn-preview"),Mn=document.getElementById("btn-export"),$n=document.getElementById("processing-overlay"),mt=document.getElementById("processing-msg"),Ve=document.getElementById("processing-sub"),gt=document.getElementById("preview-modal"),vt=document.getElementById("preview-video"),qo=document.getElementById("btn-close-preview");let Ke=!1,Nt=!1,Oe=null;function de(...t){const e=t.map(r=>typeof r=="object"?JSON.stringify(r):String(r)).join(" ");console.log(e);let n=document.getElementById("dbg-panel");n||(n=document.createElement("div"),n.id="dbg-panel",n.style.cssText="position:fixed;bottom:80px;left:0;right:0;background:rgba(0,0,0,0.85);color:#0f0;font:11px monospace;padding:8px;max-height:160px;overflow-y:auto;z-index:9999;white-space:pre-wrap;",document.body.appendChild(n));const o=document.createElement("div");o.textContent=`[${new Date().toLocaleTimeString()}] ${e}`,n.appendChild(o),n.scrollTop=n.scrollHeight}async function Vo(){Mo(rr),Ko().catch(()=>{}),kt.addEventListener("click",()=>fn("camera")),jt.addEventListener("click",()=>fn("upload")),Nn(Vt,Pn,Ee),Ee.addEventListener("click",Zo),Jo(),Fn.addEventListener("change",t=>{de(`change event: ${t.target.files.length}‰ª∂`),kn(Array.from(t.target.files))}),Bn.addEventListener("click",ir),Mn.addEventListener("click",ar),qo.addEventListener("click",hn),gt.addEventListener("click",t=>{t.target===gt&&hn()}),document.querySelectorAll(".bgm-play").forEach(t=>{t.addEventListener("click",e=>{e.preventDefault(),e.stopPropagation(),lr(t.dataset.track,t)})})}let bt=null;async function Ko(){bt=(async()=>{try{await no(),Ke=!0}catch(t){console.error("FFmpeg load error:",t)}})(),await bt}async function Un(){if(!Ke&&(bt&&await Promise.race([bt,new Promise((t,e)=>setTimeout(()=>e(new Error("timeout")),3e4))]),!Ke))throw new Error("ÂãïÁîª„Ç®„É≥„Ç∏„É≥„ÅÆË™≠„ÅøËæº„Åø„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ„Éö„Éº„Ç∏„Çí„É™„É≠„Éº„Éâ„Åó„Å¶„Åè„Å†„Åï„ÅÑ„ÄÇ")}function fn(t){t==="camera"?(kt.classList.add("active"),jt.classList.remove("active"),dn.classList.remove("hidden"),un.classList.add("hidden"),Nn(Vt,Pn,Ee)):(jt.classList.add("active"),kt.classList.remove("active"),un.classList.remove("hidden"),dn.classList.add("hidden"),Yo())}async function Zo(){if(!Nt){if(_t().length>=Ae){alert(`„ÇØ„É™„ÉÉ„Éó„ÅØÊúÄÂ§ß${Ae}Êûö„Åæ„Åß„Åß„Åô„ÄÇ`);return}Nt=!0,Ee.disabled=!0,Ee.textContent="ÊíÆÂΩ±‰∏≠...";try{const t=await Ho(Vt,Go);await or(t,`camera_${Date.now()}.webm`)}catch(t){console.error("Record error:",t),alert("ÊíÆÂΩ±„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ")}finally{Nt=!1,Ee.disabled=!1,Ee.textContent="ÊíÆÂΩ±ÈñãÂßã"}}}function Jo(){Ie.addEventListener("dragover",t=>{t.preventDefault(),Ie.classList.add("dragover")}),Ie.addEventListener("dragleave",()=>Ie.classList.remove("dragover")),Ie.addEventListener("drop",t=>{t.preventDefault(),Ie.classList.remove("dragover"),kn(Array.from(t.dataTransfer.files))})}async function kn(t){de(`handleFiles: ${t.length}‰ª∂`);const e=Ae-_t().length;if(e<=0){alert(`„ÇØ„É™„ÉÉ„Éó„ÅØÊúÄÂ§ß${Ae}Êûö„Åæ„Åß„Åß„Åô„ÄÇ`);return}const n=t.slice(0,e),o=[];for(const r of n){const i=Qo(r);if(de(`file: ${r.name} | mime: ${r.type} | type: ${i}`),i==="video"){const a=qt();Gt({id:a,type:"video",blob:r,thumbUrl:"",name:r.name,needsConvert:!0}),de(`Âç≥ÊôÇËøΩÂä†: ${r.name} (id=${a})`),o.push({id:a,file:r})}else i==="image"?tr(r):de(`„Çπ„Ç≠„ÉÉ„Éó: Êú™ÂØæÂøúÂΩ¢Âºè ${r.name}`)}Fn.value="",o.length>0&&Promise.all(o.map(({id:r,file:i})=>er(i).then(a=>{a&&(de(`„Çµ„É†„ÉçÂèñÂæóÂÆå‰∫Ü: ${i.name}`),Uo(r,a))}))).catch(r=>de(`„Çµ„É†„Éç‰∏¶ÂàóÂèñÂæó„Ç®„É©„Éº: ${r.message}`))}function Qo(t){if(t.type.startsWith("video/"))return"video";if(t.type.startsWith("image/"))return"image";const e=t.name.split(".").pop().toLowerCase(),n=["mp4","mov","avi","webm","mkv","m4v","hevc","heic"],o=["jpg","jpeg","png","gif","webp","heif"];return n.includes(e)?"video":o.includes(e)?"image":null}function er(t){return new Promise(e=>{const n=URL.createObjectURL(t),o=document.createElement("video");o.muted=!0,o.playsInline=!0,o.preload="metadata";const r=()=>URL.revokeObjectURL(n);o.onloadeddata=()=>{o.currentTime=.1},o.onseeked=()=>{try{const i=document.createElement("canvas");i.width=160,i.height=160;const a=i.getContext("2d"),s=o.videoWidth||160,l=o.videoHeight||160,c=Math.min(s,l),f=(s-c)/2,u=(l-c)/2;a.drawImage(o,f,u,c,c,0,0,160,160),e(i.toDataURL("image/jpeg",.7))}catch{e("")}finally{r()}},o.onerror=()=>{r(),e("")},setTimeout(()=>{r(),e("")},5e3),o.src=n})}async function tr(t){let e="";try{e=await nr(t)}catch(n){de(`ÁîªÂÉè„Çµ„É†„Éç„Ç®„É©„Éº: ${n.message}`)}Gt({id:qt(),type:"image",blob:t,thumbUrl:e,name:t.name,isRawImage:!0})}function nr(t){return new Promise(e=>{const n=URL.createObjectURL(t),o=new Image;o.onload=()=>{try{const r=document.createElement("canvas");r.width=160,r.height=160;const i=r.getContext("2d"),a=Math.min(o.naturalWidth,o.naturalHeight),s=(o.naturalWidth-a)/2,l=(o.naturalHeight-a)/2;i.drawImage(o,s,l,a,a,0,0,160,160),e(r.toDataURL("image/jpeg",.7))}catch{e("")}finally{URL.revokeObjectURL(n)}},o.onerror=()=>{URL.revokeObjectURL(n),e("")},setTimeout(()=>{URL.revokeObjectURL(n),e("")},5e3),o.src=n})}async function or(t,e){const n=URL.createObjectURL(t);Gt({id:qt(),type:"video",blob:t,thumbUrl:n,name:e,needsConvert:!0})}function rr(t){const e=t.length>0;Bn.disabled=!e,Mn.disabled=!e}async function ir(){const t=_t();if(t.length!==0){Ke||(yt("ÂãïÁîª„Ç®„É≥„Ç∏„É≥Ë™≠„ÅøËæº„Åø‰∏≠...","„ÇÇ„ÅÜÂ∞ë„Åó„ÅäÂæÖ„Å°„Åè„Å†„Åï„ÅÑ"),await Un()),yt("„Éó„É¨„Éì„É•„ÉºÁîüÊàê‰∏≠...","");try{const e=await jn(t,i=>{Ve.textContent=`${i}%`}),n=Wn(),o=await pn(e,n,i=>{Ve.textContent=`ÁµêÂêà‰∏≠ ${i}%`}),r=URL.createObjectURL(o);vt.src=r,Et(),gt.classList.remove("hidden"),vt.play()}catch(e){console.error("Preview error:",e),Et(),alert("„Éó„É¨„Éì„É•„Éº„ÅÆÁîüÊàê„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ")}}}function hn(){vt.pause(),vt.src="",gt.classList.add("hidden")}async function ar(){const t=_t();if(t.length!==0){Ke||(yt("ÂãïÁîª„Ç®„É≥„Ç∏„É≥Ë™≠„ÅøËæº„Åø‰∏≠...","„ÇÇ„ÅÜÂ∞ë„Åó„ÅäÂæÖ„Å°„Åè„Å†„Åï„ÅÑ"),await Un()),yt("ÂãïÁîª„ÇíÊõ∏„ÅçÂá∫„Åó‰∏≠...","Â∞ë„ÄÖ„ÅäÂæÖ„Å°„Åè„Å†„Åï„ÅÑ");try{const e=await jn(t,a=>{Ve.textContent=`ÂâçÂá¶ÁêÜ ${a}%`}),n=Wn();mt.textContent="„ÇØ„É™„ÉÉ„Éó„ÇíÁµêÂêà‰∏≠...";const o=await pn(e,n,a=>{Ve.textContent=`${a}%`});Et();const r=URL.createObjectURL(o),i=document.createElement("a");i.href=r,i.download=`cliproll_${sr()}.mp4`,i.click(),setTimeout(()=>URL.revokeObjectURL(r),1e4)}catch(e){console.error("Export error:",e),Et(),alert("Êõ∏„ÅçÂá∫„Åó„Å´Â§±Êïó„Åó„Åæ„Åó„Åü„ÄÇ")}}}async function jn(t,e){const n=[],o=t.filter(i=>i.isRawImage||i.needsConvert).length;let r=0;for(let i=0;i<t.length;i++){const a=t[i];if(a.isRawImage){mt.textContent=`ÂÜôÁúü„ÇíÂ§âÊèõ‰∏≠ ${i+1} / ${t.length}`;const s=await so(a.blob);n.push(s),r++}else if(a.needsConvert){mt.textContent=`ÂãïÁîª„ÇíÂ§âÊèõ‰∏≠ ${i+1} / ${t.length}`;const s=await lo(a.blob);n.push(s),r++}else n.push(a.blob);e==null||e(o>0?Math.round(r/o*80):80)}return n}function Wn(){var e;const t=(e=document.querySelector('input[name="bgm"]:checked'))==null?void 0:e.value;return!t||t==="none"?null:`/bgm/${t}.mp3`}function lr(t,e){if(Oe&&!Oe.paused){Oe.pause(),Oe=null,document.querySelectorAll(".bgm-play").forEach(r=>r.classList.remove("playing"));return}const n=`/bgm/${t}.mp3`,o=new Audio(n);o.onerror=()=>{e.classList.remove("playing")},o.onended=()=>{e.classList.remove("playing"),Oe=null},document.querySelectorAll(".bgm-play").forEach(r=>r.classList.remove("playing")),e.classList.add("playing"),Oe=o,o.play().catch(()=>e.classList.remove("playing"))}function yt(t,e){mt.textContent=t,Ve.textContent=e,$n.classList.remove("hidden")}function Et(){$n.classList.add("hidden")}function sr(){const t=new Date;return`${t.getFullYear()}${rt(t.getMonth()+1)}${rt(t.getDate())}_${rt(t.getHours())}${rt(t.getMinutes())}`}function rt(t){return String(t).padStart(2,"0")}Vo();
