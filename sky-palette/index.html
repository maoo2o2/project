<!DOCTYPE html>
<html lang="ja">
<head>
<meta charset="UTF-8">
<meta name="viewport" content="width=device-width, initial-scale=1.0">
<link rel="manifest" href="./manifest.json">
<meta name="theme-color" content="#87CEEB">
<meta name="apple-mobile-web-app-capable" content="yes">
<meta name="apple-mobile-web-app-status-bar-style" content="default">
<meta name="apple-mobile-web-app-title" content="空のパレット">
<link rel="apple-touch-icon" href="./icon-192.png">
<title>空のパレット — Sky Gradient Namer</title>
<style>
  @import url('https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500&family=Noto+Serif+JP:wght@400;600&display=swap');

  *, *::before, *::after { margin: 0; padding: 0; box-sizing: border-box; }

  :root {
    --bg: #fafafa;
    --text: #333;
    --text-light: #888;
    --border: #e0e0e0;
    --radius: 12px;
    --shadow: 0 2px 16px rgba(0,0,0,0.06);
    --font-sans: 'Noto Sans JP', sans-serif;
    --font-serif: 'Noto Serif JP', serif;
  }

  body {
    font-family: var(--font-sans);
    background: var(--bg);
    color: var(--text);
    min-height: 100vh;
    line-height: 1.6;
    font-weight: 300;
  }

  /* ── Header ── */
  header {
    text-align: center;
    padding: 48px 24px 32px;
  }
  header h1 {
    font-family: var(--font-serif);
    font-weight: 400;
    font-size: 1.8rem;
    letter-spacing: 0.15em;
    margin-bottom: 8px;
  }
  header p {
    color: var(--text-light);
    font-size: 0.85rem;
    letter-spacing: 0.05em;
  }

  /* ── Main container ── */
  .container {
    max-width: 560px;
    margin: 0 auto;
    padding: 0 24px 80px;
  }

  /* ── Time selector ── */
  .time-section {
    display: flex;
    align-items: center;
    justify-content: center;
    gap: 16px;
    margin-bottom: 40px;
  }
  .time-section label {
    font-size: 0.8rem;
    color: var(--text-light);
    letter-spacing: 0.05em;
  }
  .time-input {
    font-family: var(--font-sans);
    font-size: 1.1rem;
    font-weight: 400;
    padding: 8px 16px;
    border: 1px solid var(--border);
    border-radius: 8px;
    background: #fff;
    color: var(--text);
    outline: none;
    transition: border-color 0.2s;
  }
  .time-input:focus { border-color: #aaa; }
  .btn-now {
    font-family: var(--font-sans);
    font-size: 0.75rem;
    padding: 8px 16px;
    border: 1px solid var(--border);
    border-radius: 8px;
    background: #fff;
    color: var(--text);
    cursor: pointer;
    transition: all 0.2s;
    letter-spacing: 0.05em;
  }
  .btn-now:hover { background: #f0f0f0; }

  /* ── Gradient card ── */
  .gradient-card {
    border-radius: var(--radius);
    overflow: hidden;
    box-shadow: var(--shadow);
    background: #fff;
    margin-bottom: 32px;
    transition: transform 0.3s;
  }
  .gradient-preview {
    height: 320px;
    position: relative;
    transition: background 0.8s ease;
  }
  .gradient-preview .stars {
    position: absolute;
    inset: 0;
    overflow: hidden;
    pointer-events: none;
    opacity: 0;
    transition: opacity 0.8s;
  }
  .gradient-preview .stars.visible { opacity: 1; }
  .gradient-preview .star {
    position: absolute;
    width: 2px;
    height: 2px;
    background: #fff;
    border-radius: 50%;
    animation: twinkle 3s ease-in-out infinite alternate;
  }
  @keyframes twinkle {
    0% { opacity: 0.2; }
    100% { opacity: 1; }
  }
  .gradient-info {
    padding: 28px 28px 24px;
  }
  .gradient-name {
    font-family: var(--font-serif);
    font-size: 1.5rem;
    font-weight: 600;
    letter-spacing: 0.1em;
    margin-bottom: 4px;
  }
  .gradient-name-reading {
    font-size: 0.75rem;
    color: var(--text-light);
    margin-bottom: 12px;
    letter-spacing: 0.08em;
  }
  .gradient-description {
    font-size: 0.85rem;
    color: var(--text-light);
    line-height: 1.8;
  }
  .time-period-badge {
    display: inline-block;
    font-size: 0.7rem;
    color: var(--text-light);
    border: 1px solid var(--border);
    border-radius: 20px;
    padding: 2px 12px;
    margin-bottom: 12px;
    letter-spacing: 0.05em;
  }

  /* ── CSS code block ── */
  .code-section {
    margin-bottom: 32px;
  }
  .code-section h3 {
    font-size: 0.75rem;
    color: var(--text-light);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin-bottom: 12px;
    font-weight: 400;
  }
  .code-block {
    background: #fff;
    border: 1px solid var(--border);
    border-radius: var(--radius);
    padding: 20px;
    font-family: 'SF Mono', 'Fira Code', monospace;
    font-size: 0.8rem;
    line-height: 1.8;
    color: #555;
    position: relative;
    overflow-x: auto;
  }
  .code-block code {
    white-space: pre;
  }
  .btn-copy {
    position: absolute;
    top: 12px;
    right: 12px;
    font-family: var(--font-sans);
    font-size: 0.7rem;
    padding: 6px 14px;
    border: 1px solid var(--border);
    border-radius: 6px;
    background: #fafafa;
    color: var(--text-light);
    cursor: pointer;
    transition: all 0.2s;
    letter-spacing: 0.03em;
  }
  .btn-copy:hover { background: #f0f0f0; color: var(--text); }
  .btn-copy.copied { color: #5a9; border-color: #5a9; }

  /* ── Color palette ── */
  .palette-section {
    margin-bottom: 32px;
  }
  .palette-section h3 {
    font-size: 0.75rem;
    color: var(--text-light);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin-bottom: 12px;
    font-weight: 400;
  }
  .palette-row {
    display: flex;
    gap: 8px;
  }
  .palette-chip {
    flex: 1;
    height: 48px;
    border-radius: 8px;
    position: relative;
    cursor: pointer;
    transition: transform 0.2s;
    border: 1px solid rgba(0,0,0,0.05);
  }
  .palette-chip:hover { transform: scale(1.05); }
  .palette-chip .tooltip {
    position: absolute;
    bottom: -28px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.65rem;
    color: var(--text-light);
    white-space: nowrap;
    opacity: 0;
    transition: opacity 0.2s;
    pointer-events: none;
    font-family: 'SF Mono', monospace;
  }
  .palette-chip:hover .tooltip { opacity: 1; }

  /* ── Share buttons ── */
  .share-section {
    display: flex;
    gap: 12px;
    justify-content: center;
    flex-wrap: wrap;
  }
  .btn-share {
    font-family: var(--font-sans);
    font-size: 0.75rem;
    padding: 10px 24px;
    border: 1px solid var(--border);
    border-radius: 8px;
    background: #fff;
    color: var(--text);
    cursor: pointer;
    transition: all 0.2s;
    letter-spacing: 0.05em;
    text-decoration: none;
    display: inline-flex;
    align-items: center;
    gap: 6px;
  }
  .btn-share:hover { background: #f0f0f0; }
  .btn-share svg { width: 14px; height: 14px; }

  /* ── Timeline ── */
  .timeline-section {
    margin-top: 56px;
    margin-bottom: 40px;
  }
  .timeline-section h3 {
    font-size: 0.75rem;
    color: var(--text-light);
    letter-spacing: 0.1em;
    text-transform: uppercase;
    margin-bottom: 16px;
    font-weight: 400;
    text-align: center;
  }
  .timeline {
    display: flex;
    gap: 4px;
    height: 56px;
    border-radius: 8px;
    overflow: hidden;
    cursor: pointer;
  }
  .timeline-slot {
    flex: 1;
    transition: all 0.3s;
    position: relative;
  }
  .timeline-slot:hover { flex: 3; }
  .timeline-slot .slot-label {
    position: absolute;
    bottom: 4px;
    left: 50%;
    transform: translateX(-50%);
    font-size: 0.55rem;
    color: rgba(255,255,255,0.8);
    white-space: nowrap;
    opacity: 0;
    transition: opacity 0.2s;
    text-shadow: 0 1px 3px rgba(0,0,0,0.4);
  }
  .timeline-slot:hover .slot-label { opacity: 1; }

  /* ── Footer ── */
  footer {
    text-align: center;
    padding: 40px 24px;
    color: var(--text-light);
    font-size: 0.7rem;
    letter-spacing: 0.05em;
  }

  /* ── Responsive ── */
  @media (max-width: 480px) {
    header h1 { font-size: 1.4rem; }
    .gradient-preview { height: 240px; }
    .gradient-info { padding: 20px; }
    .gradient-name { font-size: 1.2rem; }
    .time-section { flex-wrap: wrap; }
  }
</style>
</head>
<body>

<header>
  <h1>空のパレット</h1>
  <p>時の移ろいを、色と名前に</p>
</header>

<div class="container">
  <!-- Time selector -->
  <div class="time-section">
    <label>時刻</label>
    <input type="time" class="time-input" id="timeInput">
    <button class="btn-now" id="btnNow">いまの空</button>
  </div>

  <!-- Gradient card -->
  <div class="gradient-card">
    <div class="gradient-preview" id="gradientPreview">
      <div class="stars" id="stars"></div>
    </div>
    <div class="gradient-info">
      <span class="time-period-badge" id="periodBadge"></span>
      <div class="gradient-name" id="gradientName"></div>
      <div class="gradient-name-reading" id="gradientReading"></div>
      <div class="gradient-description" id="gradientDesc"></div>
    </div>
  </div>

  <!-- Palette -->
  <div class="palette-section">
    <h3>Color Palette</h3>
    <div class="palette-row" id="paletteRow"></div>
  </div>

  <!-- CSS code -->
  <div class="code-section">
    <h3>CSS Code</h3>
    <div class="code-block">
      <button class="btn-copy" id="btnCopy">コピー</button>
      <code id="cssCode"></code>
    </div>
  </div>

  <!-- Share -->
  <div class="share-section">
    <a class="btn-share" id="shareTwitter" href="#" target="_blank" rel="noopener">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M18.244 2.25h3.308l-7.227 8.26 8.502 11.24H16.17l-5.214-6.817L4.99 21.75H1.68l7.73-8.835L1.254 2.25H8.08l4.713 6.231zm-1.161 17.52h1.833L7.084 4.126H5.117z"/></svg>
      ポスト
    </a>
    <button class="btn-share" id="shareLine">
      <svg viewBox="0 0 24 24" fill="currentColor"><path d="M19.365 9.863c.349 0 .63.285.63.631 0 .345-.281.63-.63.63H17.61v1.125h1.755c.349 0 .63.283.63.63 0 .344-.281.629-.63.629h-2.386c-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.627-.63h2.386c.349 0 .63.285.63.63 0 .349-.281.63-.63.63H17.61v1.125h1.755zm-3.855 3.016c0 .27-.174.51-.432.596-.064.021-.133.031-.199.031-.211 0-.391-.09-.51-.25l-2.443-3.317v2.94c0 .344-.279.629-.631.629-.346 0-.626-.285-.626-.629V8.108c0-.271.173-.508.43-.595.06-.023.136-.033.194-.033.195 0 .375.104.495.254l2.462 3.33V8.108c0-.345.282-.63.63-.63.345 0 .63.285.63.63v4.771zm-5.741 0c0 .344-.282.629-.631.629-.345 0-.627-.285-.627-.629V8.108c0-.345.282-.63.627-.63.349 0 .631.285.631.63v4.771zm-2.466.629H4.917c-.345 0-.63-.285-.63-.629V8.108c0-.345.285-.63.63-.63.348 0 .63.285.63.63v4.141h1.756c.348 0 .629.283.629.63 0 .344-.282.629-.629.629M24 10.314C24 4.943 18.615.572 12 .572S0 4.943 0 10.314c0 4.811 4.27 8.842 10.035 9.608.391.082.923.258 1.058.59.12.301.079.766.038 1.08l-.164 1.02c-.045.301-.24 1.186 1.049.645 1.291-.539 6.916-4.078 9.436-6.975C23.176 14.393 24 12.458 24 10.314"/></svg>
      LINE
    </button>
    <button class="btn-share" id="shareImage">
      <svg viewBox="0 0 24 24" fill="none" stroke="currentColor" stroke-width="2" stroke-linecap="round" stroke-linejoin="round"><rect x="3" y="3" width="18" height="18" rx="2"/><circle cx="8.5" cy="8.5" r="1.5"/><polyline points="21 15 16 10 5 21"/></svg>
      画像保存
    </button>
  </div>

  <!-- Timeline -->
  <div class="timeline-section">
    <h3>24 Hours</h3>
    <div class="timeline" id="timeline"></div>
  </div>
</div>

<footer>
  空のパレット — 時の移ろいを、色と名前に
</footer>

<script>
// ──────────────────────────────────────
// Sky Gradient Data
// ──────────────────────────────────────
const SKY_GRADIENTS = [
  // 0:00 - 3:00  深夜
  { hour: 0, period: '深夜', name: '墨染の天蓋', reading: 'すみぞめのてんがい',
    desc: '万物が眠る真夜中。墨を流したような深い闇が空を覆う。',
    colors: ['#0a0a1a', '#0f1028', '#151535'] },
  { hour: 1, period: '深夜', name: '星河の雫', reading: 'せいがのしずく',
    desc: '天の川が静かに流れる刻。藍の深みに星が瞬く。',
    colors: ['#0b0b1e', '#101030', '#181840'] },
  { hour: 2, period: '深夜', name: '夜想の帳', reading: 'やそうのとばり',
    desc: '夜の最も深い時間。静寂が色を帯びるような紺碧の空。',
    colors: ['#0c0c22', '#111138', '#1a1a45'] },
  { hour: 3, period: '未明', name: '暁待ちの紺', reading: 'あかつきまちのこん',
    desc: '夜明けを待つ空。まだ暗いが、東の端にかすかな予感。',
    colors: ['#0e1030', '#141845', '#1e2555'] },

  // 4:00 - 5:00  黎明
  { hour: 4, period: '黎明', name: '東雲の序章', reading: 'しののめのじょしょう',
    desc: '空の東端がわずかに明るみ始める。夜と朝の境界線。',
    colors: ['#1a1840', '#2a2060', '#3a2555', '#1e1535'] },
  { hour: 5, period: '黎明', name: '曙光の衣', reading: 'しょこうのころも',
    desc: '地平線に淡い光が滲み出す。紫と紺が溶け合う黎明の空。',
    colors: ['#2d1b4e', '#4a2060', '#6b3065', '#ff6b4a'] },

  // 6:00 - 7:00  朝焼け
  { hour: 6, period: '朝焼け', name: '茜染めの空', reading: 'あかねぞめのそら',
    desc: '朝焼けが空を茜色に染め上げる。一日の始まりを告げる荘厳な光景。',
    colors: ['#ff6b35', '#ff8c42', '#ffa64d', '#ffcc66', '#87ceeb'] },
  { hour: 7, period: '朝焼け', name: '朝凪の薄紅', reading: 'あさなぎのうすべに',
    desc: '朝焼けが落ち着き、空が薄紅から水色へと移りゆく穏やかな時間。',
    colors: ['#ffa07a', '#ffb6a3', '#ffd1c4', '#b0d4f1', '#87ceeb'] },

  // 8:00 - 10:00  午前
  { hour: 8, period: '朝', name: '若空の碧', reading: 'わかぞらのあお',
    desc: '澄み切った朝の空。若々しい碧色が広がりはじめる。',
    colors: ['#87ceeb', '#9dd5ed', '#b0e0f0'] },
  { hour: 9, period: '午前', name: '天青の綾', reading: 'てんせいのあや',
    desc: '青空が高く澄み渡る。天の青が美しい綾模様を織りなす。',
    colors: ['#5cb8e6', '#6bc5ea', '#87ceeb'] },
  { hour: 10, period: '午前', name: '碧落の絹', reading: 'へきらくのきぬ',
    desc: '空が碧落と呼ぶにふさわしい深い青に。絹のように滑らかな蒼穹。',
    colors: ['#4aa3df', '#5bb5e8', '#70c4ef'] },

  // 11:00 - 13:00  昼
  { hour: 11, period: '昼前', name: '蒼穹の頂', reading: 'そうきゅうのいただき',
    desc: '太陽が高く昇り、空は最も深い青をたたえる。',
    colors: ['#3a8fd4', '#4da6e5', '#65b5ec'] },
  { hour: 12, period: '真昼', name: '天心の蒼', reading: 'てんしんのあお',
    desc: '太陽が天頂に達する真昼。空は力強い蒼色に満ちる。',
    colors: ['#2e86c1', '#4a9fd8', '#65b3e5'] },
  { hour: 13, period: '午後', name: '白昼の青磁', reading: 'はくちゅうのせいじ',
    desc: '午後の始まり。空は青磁のような柔らかな青を湛える。',
    colors: ['#3d94d4', '#5aa8e0', '#78bde8'] },

  // 14:00 - 16:00  午後
  { hour: 14, period: '午後', name: '午下がりの空色', reading: 'ごさがりのそらいろ',
    desc: '午後のゆるやかな時間。空色がどこか優しさを帯びる。',
    colors: ['#5ba0d8', '#74b4e2', '#8ec6eb'] },
  { hour: 15, period: '午後', name: '移ろいの水浅葱', reading: 'うつろいのみずあさぎ',
    desc: '日が西に傾きはじめ、空の青がわずかに淡く変わる。',
    colors: ['#6db3e0', '#87c5ea', '#a0d4ef'] },
  { hour: 16, period: '夕方', name: '黄昏の始まり', reading: 'たそがれのはじまり',
    desc: '夕方の気配が忍び寄る。空の端が温かみを帯びはじめる。',
    colors: ['#87c5ea', '#a0cfe0', '#cdb98d', '#e8b86d'] },

  // 17:00 - 18:00  夕焼け
  { hour: 17, period: '夕焼け', name: '落暉の錦', reading: 'らっきのにしき',
    desc: '夕日が空を錦のように染め上げる。橙と紫が織りなす壮麗な光景。',
    colors: ['#ff7043', '#ff9a5c', '#ffc178', '#e8a060', '#9b7cb8'] },
  { hour: 18, period: '夕焼け', name: '残照の薄衣', reading: 'ざんしょうのうすぎぬ',
    desc: '日没後の残照。空に薄衣のような茜色と紫が漂う。',
    colors: ['#c05070', '#a04080', '#704090', '#503880', '#2a2060'] },

  // 19:00 - 20:00  宵
  { hour: 19, period: '宵', name: '宵闇の紫苑', reading: 'よいやみのしおん',
    desc: '宵闘がゆっくりと降りてくる。紫苑色が空を包みはじめる。',
    colors: ['#3a2060', '#2a1850', '#1e1440'] },
  { hour: 20, period: '宵', name: '群青の沈黙', reading: 'ぐんじょうのちんもく',
    desc: '空が群青色に沈み、最初の星が現れる静かな宵。',
    colors: ['#1a1445', '#151238', '#10102e'] },

  // 21:00 - 23:00  夜
  { hour: 21, period: '夜', name: '藍夜の深淵', reading: 'あいやのしんえん',
    desc: '深い藍色の夜空。都会の灯りが届かぬ深淵のような暗さ。',
    colors: ['#0e0e28', '#121238', '#0a0a20'] },
  { hour: 22, period: '夜', name: '天鵞絨の闇', reading: 'びろうどのやみ',
    desc: '天鵞絨のように柔らかな夜の闇。深く、しかしどこか温もりのある暗さ。',
    colors: ['#0b0b22', '#0f0f30', '#090918'] },
  { hour: 23, period: '夜', name: '子の刻の紺青', reading: 'ねのときのこんじょう',
    desc: '深夜へ向かう夜更け。紺青の空に無数の星が散りばめられる。',
    colors: ['#0a0a1e', '#0e0e2a', '#080818'] },
];

// ──────────────────────────────────────
// Core Functions
// ──────────────────────────────────────

function getGradientForTime(hours, minutes) {
  const idx = hours % 24;
  const current = SKY_GRADIENTS[idx];
  const next = SKY_GRADIENTS[(idx + 1) % 24];
  const t = minutes / 60;
  return {
    colors: interpolateColors(current.colors, next.colors, t),
    name: t < 0.5 ? current.name : next.name,
    reading: t < 0.5 ? current.reading : next.reading,
    desc: t < 0.5 ? current.desc : next.desc,
    period: t < 0.5 ? current.period : next.period,
  };
}

function interpolateColors(colorsA, colorsB, t) {
  const maxLen = Math.max(colorsA.length, colorsB.length);
  const result = [];
  for (let i = 0; i < maxLen; i++) {
    const a = hexToRgb(colorsA[Math.min(i, colorsA.length - 1)]);
    const b = hexToRgb(colorsB[Math.min(i, colorsB.length - 1)]);
    const r = Math.round(a.r + (b.r - a.r) * t);
    const g = Math.round(a.g + (b.g - a.g) * t);
    const bl = Math.round(a.b + (b.b - a.b) * t);
    result.push(rgbToHex(r, g, bl));
  }
  return result;
}

function hexToRgb(hex) {
  const n = parseInt(hex.replace('#', ''), 16);
  return { r: (n >> 16) & 255, g: (n >> 8) & 255, b: n & 255 };
}

function rgbToHex(r, g, b) {
  return '#' + [r, g, b].map(x => x.toString(16).padStart(2, '0')).join('');
}

function buildGradientCSS(colors) {
  const stops = colors.map((c, i) => {
    const pct = Math.round((i / (colors.length - 1)) * 100);
    return `  ${c} ${pct}%`;
  }).join(',\n');
  return `background: linear-gradient(\n  to bottom,\n${stops}\n);`;
}

function buildGradientStyle(colors) {
  const stops = colors.map((c, i) => {
    const pct = Math.round((i / (colors.length - 1)) * 100);
    return `${c} ${pct}%`;
  }).join(', ');
  return `linear-gradient(to bottom, ${stops})`;
}

// ──────────────────────────────────────
// Stars for night sky
// ──────────────────────────────────────

function generateStars() {
  const container = document.getElementById('stars');
  container.innerHTML = '';
  for (let i = 0; i < 50; i++) {
    const star = document.createElement('div');
    star.className = 'star';
    star.style.left = Math.random() * 100 + '%';
    star.style.top = Math.random() * 100 + '%';
    star.style.animationDelay = Math.random() * 3 + 's';
    star.style.width = (Math.random() * 2 + 1) + 'px';
    star.style.height = star.style.width;
    container.appendChild(star);
  }
}

function isNightTime(hours) {
  return hours >= 19 || hours <= 4;
}

// ──────────────────────────────────────
// UI Update
// ──────────────────────────────────────

function updateDisplay(hours, minutes) {
  const data = getGradientForTime(hours, minutes);

  // Gradient preview
  const preview = document.getElementById('gradientPreview');
  preview.style.background = buildGradientStyle(data.colors);

  // Stars
  const stars = document.getElementById('stars');
  stars.classList.toggle('visible', isNightTime(hours));

  // Info
  document.getElementById('periodBadge').textContent = data.period;
  document.getElementById('gradientName').textContent = data.name;
  document.getElementById('gradientReading').textContent = data.reading;
  document.getElementById('gradientDesc').textContent = data.desc;

  // CSS code
  document.getElementById('cssCode').textContent = buildGradientCSS(data.colors);

  // Palette
  const paletteRow = document.getElementById('paletteRow');
  paletteRow.innerHTML = '';
  data.colors.forEach(color => {
    const chip = document.createElement('div');
    chip.className = 'palette-chip';
    chip.style.background = color;
    chip.innerHTML = `<span class="tooltip">${color}</span>`;
    chip.addEventListener('click', () => {
      navigator.clipboard.writeText(color).then(() => {
        chip.querySelector('.tooltip').textContent = 'Copied!';
        setTimeout(() => {
          chip.querySelector('.tooltip').textContent = color;
        }, 1200);
      });
    });
    paletteRow.appendChild(chip);
  });

  // Share link
  updateShareLinks(data, hours, minutes);
}

function updateShareLinks(data, hours, minutes) {
  const timeStr = String(hours).padStart(2, '0') + ':' + String(minutes).padStart(2, '0');
  const text = `${timeStr} の空は「${data.name}」\n${data.desc}\n\n#空のパレット #SkyGradient`;
  const encodedText = encodeURIComponent(text);

  document.getElementById('shareTwitter').href =
    `https://twitter.com/intent/tweet?text=${encodedText}`;
}

// ──────────────────────────────────────
// Timeline
// ──────────────────────────────────────

function buildTimeline() {
  const timeline = document.getElementById('timeline');
  timeline.innerHTML = '';
  for (let h = 0; h < 24; h++) {
    const data = SKY_GRADIENTS[h];
    const slot = document.createElement('div');
    slot.className = 'timeline-slot';
    slot.style.background = buildGradientStyle(data.colors);
    slot.innerHTML = `<span class="slot-label">${String(h).padStart(2, '0')}:00</span>`;
    slot.addEventListener('click', () => {
      document.getElementById('timeInput').value = String(h).padStart(2, '0') + ':00';
      updateDisplay(h, 0);
    });
    timeline.appendChild(slot);
  }
}

// ──────────────────────────────────────
// Image Export (Canvas)
// ──────────────────────────────────────

function exportImage(hours, minutes) {
  const data = getGradientForTime(hours, minutes);
  const canvas = document.createElement('canvas');
  canvas.width = 1080;
  canvas.height = 1080;
  const ctx = canvas.getContext('2d');

  // Draw gradient
  const grad = ctx.createLinearGradient(0, 0, 0, canvas.height);
  data.colors.forEach((color, i) => {
    grad.addColorStop(i / (data.colors.length - 1), color);
  });
  ctx.fillStyle = grad;
  ctx.fillRect(0, 0, canvas.width, canvas.height);

  // Text overlay
  ctx.fillStyle = 'rgba(255,255,255,0.9)';
  ctx.textAlign = 'center';

  ctx.font = '600 64px "Noto Serif JP", serif';
  ctx.fillText(data.name, canvas.width / 2, canvas.height / 2 - 20);

  ctx.font = '300 24px "Noto Sans JP", sans-serif';
  ctx.fillText(data.reading, canvas.width / 2, canvas.height / 2 + 30);

  const timeStr = String(hours).padStart(2, '0') + ':' + String(minutes).padStart(2, '0');
  ctx.font = '300 20px "Noto Sans JP", sans-serif';
  ctx.fillStyle = 'rgba(255,255,255,0.6)';
  ctx.fillText(timeStr + ' — ' + data.period, canvas.width / 2, canvas.height / 2 + 70);

  ctx.font = '300 16px "Noto Sans JP", sans-serif';
  ctx.fillStyle = 'rgba(255,255,255,0.4)';
  ctx.fillText('空のパレット', canvas.width / 2, canvas.height - 40);

  // Download
  const link = document.createElement('a');
  link.download = `sky-${data.name}-${timeStr.replace(':', '')}.png`;
  link.href = canvas.toDataURL('image/png');
  link.click();
}

// ──────────────────────────────────────
// Event Listeners
// ──────────────────────────────────────

document.addEventListener('DOMContentLoaded', () => {
  generateStars();
  buildTimeline();

  const timeInput = document.getElementById('timeInput');
  const now = new Date();
  const h = now.getHours();
  const m = now.getMinutes();
  timeInput.value = String(h).padStart(2, '0') + ':' + String(m).padStart(2, '0');
  updateDisplay(h, m);

  timeInput.addEventListener('input', () => {
    const [hh, mm] = timeInput.value.split(':').map(Number);
    if (!isNaN(hh) && !isNaN(mm)) updateDisplay(hh, mm);
  });

  document.getElementById('btnNow').addEventListener('click', () => {
    const n = new Date();
    const hh = n.getHours();
    const mm = n.getMinutes();
    timeInput.value = String(hh).padStart(2, '0') + ':' + String(mm).padStart(2, '0');
    updateDisplay(hh, mm);
  });

  document.getElementById('btnCopy').addEventListener('click', () => {
    const code = document.getElementById('cssCode').textContent;
    navigator.clipboard.writeText(code).then(() => {
      const btn = document.getElementById('btnCopy');
      btn.textContent = 'コピー完了';
      btn.classList.add('copied');
      setTimeout(() => {
        btn.textContent = 'コピー';
        btn.classList.remove('copied');
      }, 2000);
    });
  });

  document.getElementById('shareLine').addEventListener('click', () => {
    const [hh, mm] = timeInput.value.split(':').map(Number);
    const data = getGradientForTime(hh, mm);
    const timeStr = String(hh).padStart(2, '0') + ':' + String(mm).padStart(2, '0');
    const text = `${timeStr} の空は「${data.name}」\n${data.desc}\n\n#空のパレット`;
    const url = `https://social-plugins.line.me/lineit/share?text=${encodeURIComponent(text)}`;
    window.open(url, '_blank', 'width=500,height=600');
  });

  document.getElementById('shareImage').addEventListener('click', () => {
    const [hh, mm] = timeInput.value.split(':').map(Number);
    exportImage(hh, mm);
  });
});

if ('serviceWorker' in navigator) {
  navigator.serviceWorker.register('./sw.js');
}
</script>
</body>
</html>
